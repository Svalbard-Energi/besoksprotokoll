import{c as A,a as L,f as V}from"./YZ5Zo5Xd.js";import{i as ct}from"./BiU8bGry.js";import{h as se,P as Yt,b as Qt,y as b,aw as Jt,aq as ei,R as ti,Y as Je,W as xe,a7 as ke,f as fe,Q as ii,ac as si,V as et,c as ri,e as qe,s as ai,aa as ut,aE as oi,a as De,am as ni,M as tt,aP as ht,aQ as gt,aR as li,r as dt,p as ci,aS as Le,a5 as ui,aT as hi,aU as gi,a9 as di,d as pi,a3 as mi,aV as pt,I as fi,aW as vi,ax as J,u as G,aj as F,an as ee,g as X,K as O,i as Z,j as oe,aX as le,ap as ne,k as ce,l as K,v as yi,t as ge,aY as wi}from"./C2gCytJl.js";import{a as Ae,S as mt,b as ae,r as bi,s as Si}from"./BE4rq0FU.js";import{_ as it,p as Ri,i as te,c as Ne,b as ft,r as Ue}from"./DBHFiZT6.js";import{s as Y}from"./DyXzYyNk.js";import{d as Ci,f as Ti}from"./x9zuId2S.js";import{b as xi}from"./BbmGp7N3.js";function ki(t,e){return e}function Li(t,e,i){for(var s=[],r=e.length,a=0;a<r;a++)hi(e[a].e,s,!0);gi(s,()=>{var o=s.length===0&&i!==null;if(o){var n=i,l=n.parentNode;di(l),l.append(n),t.items.clear(),B(t,e[0].prev,e[r-1].next)}for(var c=0;c<r;c++){var u=e[c];o||(t.items.delete(u.k),B(t,u.prev,u.next)),pi(u.e,!o)}t.first===e[0]&&(t.first=e[0].prev)})}function ve(t,e,i,s,r,a=null){var o=t,n={items:new Map,first:null},l=(e&pt)!==0,c=(e&gt)!==0,u=(e&ht)!==0;if(l){var h=t;o=se?xe(mi(h)):h.appendChild(De())}se&&Yt();var g=null,d=Jt(()=>{var y=i();return oi(y)?y:y==null?[]:ut(y)}),p,R=!0;function _(){Ei(m,p,n,o,e,s),g!==null&&(p.length===0?(g.fragment?(o.before(g.fragment),g.fragment=null):dt(g.effect),m.first=g.effect):ci(g.effect,()=>{g=null}))}var m=Qt(()=>{p=b(d);var y=p.length;let x=!1;if(se){var I=ei(o)===ti;I!==(y===0)&&(o=Je(),xe(o),ke(!1),x=!0)}for(var C=new Set,z=ri,T=null,k=ai(),E=0;E<y;E+=1){se&&fe.nodeType===ii&&fe.data===si&&(o=fe,x=!0,ke(!1));var j=p[E],ie=s(j,E),N=R?null:n.items.get(ie);N?(c&&et(N.v,j),u?et(N.i,E):N.i=E,k&&z.skipped_effects.delete(N.e)):(N=_i(R?o:null,T,j,ie,E,r,e,i),R&&(N.o=!0,T===null?n.first=N:T.next=N,T=N),n.items.set(ie,N)),C.add(ie)}if(y===0&&a&&!g)if(R)g={fragment:null,effect:qe(()=>a(o))};else{var Ye=document.createDocumentFragment(),Qe=De();Ye.append(Qe),g={fragment:Ye,effect:qe(()=>a(Qe))}}if(se&&y>0&&xe(Je()),!R)if(k){for(const[Kt,Ft]of n.items)C.has(Kt)||z.skipped_effects.add(Ft.e);z.oncommit(_),z.ondiscard(()=>{})}else _();x&&ke(!0),b(d)});R=!1,se&&(o=fe)}function Ei(t,e,i,s,r,a){var o=(r&vi)!==0,n=e.length,l=i.items,c=i.first,u,h=null,g,d=[],p=[],R,_,m,y;if(o)for(y=0;y<n;y+=1)R=e[y],_=a(R,y),m=l.get(_),m.a?.measure(),(g??=new Set).add(m);for(y=0;y<n;y+=1){if(R=e[y],_=a(R,y),m=l.get(_),i.first??=m,!m.o){m.o=!0;var x=h?h.next:c;B(i,h,m),B(i,m,x),Ee(m,x,s),h=m,d=[],p=[],c=h.next;continue}if((m.e.f&Le)!==0&&(dt(m.e),o&&(m.a?.unfix(),(g??=new Set).delete(m))),m!==c){if(u!==void 0&&u.has(m)){if(d.length<p.length){var I=p[0],C;h=I.prev;var z=d[0],T=d[d.length-1];for(C=0;C<d.length;C+=1)Ee(d[C],I,s);for(C=0;C<p.length;C+=1)u.delete(p[C]);B(i,z.prev,T.next),B(i,h,z),B(i,T,I),c=I,h=T,y-=1,d=[],p=[]}else u.delete(m),Ee(m,c,s),B(i,m.prev,m.next),B(i,m,h===null?i.first:h.next),B(i,h,m),h=m;continue}for(d=[],p=[];c!==null&&c.k!==_;)(c.e.f&Le)===0&&(u??=new Set).add(c),p.push(c),c=c.next;if(c===null)continue;m=c}d.push(m),h=m,c=m.next}if(c!==null||u!==void 0){for(var k=u===void 0?[]:ut(u);c!==null;)(c.e.f&Le)===0&&k.push(c),c=c.next;var E=k.length;if(E>0){var j=(r&pt)!==0&&n===0?s:null;if(o){for(y=0;y<E;y+=1)k[y].a?.measure();for(y=0;y<E;y+=1)k[y].a?.fix()}Li(i,k,j)}}o&&fi(()=>{if(g!==void 0)for(m of g)m.a?.apply()}),t.first=i.first&&i.first.e,t.last=h&&h.e,h&&(h.e.next=null)}function _i(t,e,i,s,r,a,o,n){var l=(o&gt)!==0,c=(o&li)===0,u=l?c?ni(i,!1,!1):tt(i):i,h=(o&ht)===0?r:tt(r),g={i:h,v:u,k:s,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var d=document.createDocumentFragment();d.append(t=De())}return g.e=qe(()=>a(t,u,h,n)),g.e.prev=e&&e.e,e!==null&&(e.next=g,e.e.next=g.e),g}finally{}}function Ee(t,e,i){for(var s=t.next?t.next.e.nodes_start:i,r=e?e.e.nodes_start:i,a=t.e.nodes_start;a!==null&&a!==s;){var o=ui(a);r.before(a),a=o}}function B(t,e,i){e===null?t.first=i:(e.next=i,e.e.next=i&&i.e),i!==null&&(i.prev=e,i.e.prev=e&&e.e)}var Ge=(t=>(t[t.Degree0=0]="Degree0",t[t.Degree90=1]="Degree90",t[t.Degree180=2]="Degree180",t[t.Degree270=3]="Degree270",t))(Ge||{});function Ii(t){return{x:Math.floor(t.x),y:Math.floor(t.y)}}function zi(t){return{width:Math.ceil(t.width),height:Math.ceil(t.height)}}function Jr(t){return{origin:Ii(t.origin),size:zi(t.size)}}function Oe(t){const{width:e,height:i}=t;return{width:i,height:e}}function qi(t,e,i){return t=e%2===0?t:Oe(t),{width:t.width*i,height:t.height*i}}function ea(t){const e=[t.p1.x,t.p2.x,t.p3.x,t.p4.x],i=[t.p1.y,t.p2.y,t.p3.y,t.p4.y];return{origin:{x:Math.min(...e),y:Math.min(...i)},size:{width:Math.max(...e)-Math.min(...e),height:Math.max(...i)-Math.min(...i)}}}function ta(t){return{p1:{x:t.origin.x,y:t.origin.y},p2:{x:t.origin.x+t.size.width,y:t.origin.y},p3:{x:t.origin.x+t.size.width,y:t.origin.y+t.size.height},p4:{x:t.origin.x,y:t.origin.y+t.size.height}}}function Di(t,e,i){let s=e.x,r=e.y;switch(i){case 0:s=e.x,r=e.y;break;case 1:s=t.height-e.y,r=e.x;break;case 2:s=t.width-e.x,r=t.height-e.y;break;case 3:s=e.y,r=t.width-e.x;break}return{x:s,y:r}}function $e(t,e){return{x:t.x*e,y:t.y*e}}function Ni(t,e,i,s){return $e(Di(t,e,i),s)}function vt(t,e,i){let s=e.origin.x,r=e.origin.y,a=e.size;switch(i){case 0:break;case 1:s=t.height-e.origin.y-e.size.height,r=e.origin.x,a=Oe(e.size);break;case 2:s=t.width-e.origin.x-e.size.width,r=t.height-e.origin.y-e.size.height;break;case 3:s=e.origin.y,r=t.width-e.origin.x-e.size.width,a=Oe(e.size);break}return{origin:{x:s,y:r},size:{width:a.width,height:a.height}}}function Oi(t,e){return{origin:{x:t.origin.x*e,y:t.origin.y*e},size:{width:t.size.width*e,height:t.size.height*e}}}function $i(t,e,i,s){return Oi(vt(t,e,i),s)}function ia(t,e,i,s){const r=t.origin.x,a=t.origin.y,o=t.size.width,n=t.size.height,l=i/o,c=s/n,u=i/n,h=s/o;switch(e){case 0:return{a:l,b:0,c:0,d:c,e:-l*r,f:-c*a};case 3:return{a:0,b:-h,c:u,d:0,e:-u*a,f:h*(r+o)};case 2:return{a:-l,b:0,c:0,d:-c,e:l*(r+o),f:c*(a+n)};case 1:return{a:0,b:h,c:-u,d:0,e:u*(a+n),f:-h*r}}}class We{isEnabled(){return!1}debug(){}info(){}warn(){}error(){}perf(){}}class Hi{isEnabled(){return!0}debug(e,i,...s){console.debug(`${e}.${i}`,...s)}info(e,i,...s){console.info(`${e}.${i}`,...s)}warn(e,i,...s){console.warn(`${e}.${i}`,...s)}error(e,i,...s){console.error(`${e}.${i}`,...s)}perf(e,i,s,r,...a){console.info(`${e}.${i}.${s}.${r}`,...a)}}class Mi{constructor(e,i){this.logger=e,this.level=i}isEnabled(e){const i={debug:0,info:1,warn:2,error:3};return this.level<=i[e]}debug(e,i,...s){this.level<=0&&this.logger.debug(e,i,...s)}info(e,i,...s){this.level<=1&&this.logger.info(e,i,...s)}warn(e,i,...s){this.level<=2&&this.logger.warn(e,i,...s)}error(e,i,...s){this.level<=3&&this.logger.error(e,i,...s)}perf(e,i,s,r,...a){this.logger.perf(e,i,s,r,...a)}}class Ai{constructor(){}isEnabled(){return!1}debug(e,i,...s){}info(e,i,...s){}warn(e,i,...s){}error(e,i,...s){}perf(e,i,s,r,a,...o){switch(r){case"Begin":globalThis.performance.mark(`${e}.${i}.${s}.${r}.${a}`,{detail:o});break;case"End":globalThis.performance.mark(`${e}.${i}.${s}.${r}.${a}`,{detail:o}),globalThis.performance.measure(`${e}.${i}.${s}.Measure.${a}`,`${e}.${i}.${s}.Begin.${a}`,`${e}.${i}.${s}.End.${a}`);break}}}class Ui{constructor(e){this.loggers=e}isEnabled(e){return this.loggers.some(i=>i.isEnabled(e))}debug(e,i,...s){for(const r of this.loggers)r.debug(e,i,...s)}info(e,i,...s){for(const r of this.loggers)r.info(e,i,...s)}warn(e,i,...s){for(const r of this.loggers)r.warn(e,i,...s)}error(e,i,...s){for(const r of this.loggers)r.error(e,i,...s)}perf(e,i,s,r,...a){for(const o of this.loggers)o.perf(e,i,s,r,...a)}}class Gi extends Error{constructor(e){super(`Task aborted: ${JSON.stringify(e)}`),this.name="TaskAbortedError",this.reason=e}}class Wi extends Error{constructor(e){super(`Task rejected: ${JSON.stringify(e)}`),this.name="TaskRejectedError",this.reason=e}}class P{constructor(){this.state={stage:0},this.resolvedCallbacks=[],this.rejectedCallbacks=[],this._promise=null,this.progressCbs=[]}toPromise(){return this._promise||(this._promise=new Promise((e,i)=>{this.wait(s=>e(s),s=>{s.type==="abort"?i(new Gi(s.reason)):i(new Wi(s.reason))})})),this._promise}wait(e,i){switch(this.state.stage){case 0:this.resolvedCallbacks.push(e),this.rejectedCallbacks.push(i);break;case 1:e(this.state.result);break;case 2:i({type:"reject",reason:this.state.reason});break;case 3:i({type:"abort",reason:this.state.reason});break}}resolve(e){if(this.state.stage===0){this.state={stage:1,result:e};for(const i of this.resolvedCallbacks)try{i(e)}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}reject(e){if(this.state.stage===0){this.state={stage:2,reason:e};for(const i of this.rejectedCallbacks)try{i({type:"reject",reason:e})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}abort(e){if(this.state.stage===0){this.state={stage:3,reason:e};for(const i of this.rejectedCallbacks)try{i({type:"abort",reason:e})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}fail(e){e.type==="abort"?this.abort(e.reason):this.reject(e.reason)}onProgress(e){this.progressCbs.push(e)}progress(e){for(const i of this.progressCbs)i(e)}static all(e){const i=new P;if(e.length===0)return i.resolve([]),i;const s=new Array(e.length);let r=0,a=!1;return e.forEach((o,n)=>{o.wait(l=>{a||(s[n]=l,r++,r===e.length&&(a=!0,i.resolve(s)))},l=>{a||(a=!0,l.type==="abort"?i.abort(l.reason):i.reject(l.reason))})}),i}static allSettled(e){const i=new P;if(e.length===0)return i.resolve([]),i;const s=new Array(e.length);let r=0;return e.forEach((a,o)=>{a.wait(n=>{s[o]={status:"resolved",value:n},r++,r===e.length&&i.resolve(s)},n=>{s[o]={status:n.type==="abort"?"aborted":"rejected",reason:n.reason},r++,r===e.length&&i.resolve(s)})}),i}static race(e){const i=new P;if(e.length===0)return i.reject("No tasks provided"),i;let s=!1;return e.forEach(r=>{r.wait(a=>{s||(s=!0,i.resolve(a))},a=>{s||(s=!0,a.type==="abort"?i.abort(a.reason):i.reject(a.reason))})}),i}static withProgress(e,i){const s=P.all(e);if(i){let r=0;e.forEach(a=>{a.wait(()=>{r++,i(r,e.length)},()=>{r++,i(r,e.length)})})}return s}}const Vi="­",Bi="​",Pi="⁠",Xi="\uFEFF",Zi="￾",ji="￿",Ki=Object.freeze([Vi,Bi,Pi,Xi,Zi,ji]),Fi=new RegExp(`[${Ki.join("")}]`,"g");function sa(t){return t.replace(Fi,"")}var Yi=(t=>(t[t.Unknown=0]="Unknown",t[t.XYZ=1]="XYZ",t[t.FitPage=2]="FitPage",t[t.FitHorizontal=3]="FitHorizontal",t[t.FitVertical=4]="FitVertical",t[t.FitRectangle=5]="FitRectangle",t[t.FitBoundingBox=6]="FitBoundingBox",t[t.FitBoundingBoxHorizontal=7]="FitBoundingBoxHorizontal",t[t.FitBoundingBoxVertical=8]="FitBoundingBoxVertical",t))(Yi||{}),Qi=(t=>(t[t.NotSet=0]="NotSet",t[t.True=1]="True",t[t.False=2]="False",t[t.Unknown=3]="Unknown",t))(Qi||{}),D=(t=>(t[t.Unknown=-1]="Unknown",t[t.Courier=0]="Courier",t[t.Courier_Bold=1]="Courier_Bold",t[t.Courier_BoldOblique=2]="Courier_BoldOblique",t[t.Courier_Oblique=3]="Courier_Oblique",t[t.Helvetica=4]="Helvetica",t[t.Helvetica_Bold=5]="Helvetica_Bold",t[t.Helvetica_BoldOblique=6]="Helvetica_BoldOblique",t[t.Helvetica_Oblique=7]="Helvetica_Oblique",t[t.Times_Roman=8]="Times_Roman",t[t.Times_Bold=9]="Times_Bold",t[t.Times_BoldItalic=10]="Times_BoldItalic",t[t.Times_Italic=11]="Times_Italic",t[t.Symbol=12]="Symbol",t[t.ZapfDingbats=13]="ZapfDingbats",t))(D||{}),ye=(t=>(t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t))(ye||{}),q=(t=>(t[t.Normal=0]="Normal",t[t.Multiply=1]="Multiply",t[t.Screen=2]="Screen",t[t.Overlay=3]="Overlay",t[t.Darken=4]="Darken",t[t.Lighten=5]="Lighten",t[t.ColorDodge=6]="ColorDodge",t[t.ColorBurn=7]="ColorBurn",t[t.HardLight=8]="HardLight",t[t.SoftLight=9]="SoftLight",t[t.Difference=10]="Difference",t[t.Exclusion=11]="Exclusion",t[t.Hue=12]="Hue",t[t.Saturation=13]="Saturation",t[t.Color=14]="Color",t[t.Luminosity=15]="Luminosity",t))(q||{}),Ji=(t=>(t[t.Contain=0]="Contain",t[t.Cover=1]="Cover",t[t.Stretch=2]="Stretch",t))(Ji||{}),es=(t=>(t[t.Unsupported=0]="Unsupported",t[t.Goto=1]="Goto",t[t.RemoteGoto=2]="RemoteGoto",t[t.URI=3]="URI",t[t.LaunchAppOrOpenFile=4]="LaunchAppOrOpenFile",t))(es||{}),ts=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.TEXT=1]="TEXT",t[t.LINK=2]="LINK",t[t.FREETEXT=3]="FREETEXT",t[t.LINE=4]="LINE",t[t.SQUARE=5]="SQUARE",t[t.CIRCLE=6]="CIRCLE",t[t.POLYGON=7]="POLYGON",t[t.POLYLINE=8]="POLYLINE",t[t.HIGHLIGHT=9]="HIGHLIGHT",t[t.UNDERLINE=10]="UNDERLINE",t[t.SQUIGGLY=11]="SQUIGGLY",t[t.STRIKEOUT=12]="STRIKEOUT",t[t.STAMP=13]="STAMP",t[t.CARET=14]="CARET",t[t.INK=15]="INK",t[t.POPUP=16]="POPUP",t[t.FILEATTACHMENT=17]="FILEATTACHMENT",t[t.SOUND=18]="SOUND",t[t.MOVIE=19]="MOVIE",t[t.WIDGET=20]="WIDGET",t[t.SCREEN=21]="SCREEN",t[t.PRINTERMARK=22]="PRINTERMARK",t[t.TRAPNET=23]="TRAPNET",t[t.WATERMARK=24]="WATERMARK",t[t.THREED=25]="THREED",t[t.RICHMEDIA=26]="RICHMEDIA",t[t.XFAWIDGET=27]="XFAWIDGET",t[t.REDACT=28]="REDACT",t))(ts||{}),is=(t=>(t[t.Normal=0]="Normal",t[t.Rollover=1]="Rollover",t[t.Down=2]="Down",t))(is||{}),ss=(t=>(t[t.Unknown=-1]="Unknown",t[t.Comment=0]="Comment",t[t.Key=1]="Key",t[t.Note=2]="Note",t[t.Help=3]="Help",t[t.NewParagraph=4]="NewParagraph",t[t.Paragraph=5]="Paragraph",t[t.Insert=6]="Insert",t[t.Graph=7]="Graph",t[t.PushPin=8]="PushPin",t[t.Paperclip=9]="Paperclip",t[t.Tag=10]="Tag",t[t.Speaker=11]="Speaker",t[t.Mic=12]="Mic",t[t.Approved=13]="Approved",t[t.Experimental=14]="Experimental",t[t.NotApproved=15]="NotApproved",t[t.AsIs=16]="AsIs",t[t.Expired=17]="Expired",t[t.NotForPublicRelease=18]="NotForPublicRelease",t[t.Confidential=19]="Confidential",t[t.Final=20]="Final",t[t.Sold=21]="Sold",t[t.Departmental=22]="Departmental",t[t.ForComment=23]="ForComment",t[t.TopSecret=24]="TopSecret",t[t.Draft=25]="Draft",t[t.ForPublicRelease=26]="ForPublicRelease",t))(ss||{}),rs=(t=>(t[t.None=0]="None",t[t.Square=1]="Square",t[t.Circle=2]="Circle",t[t.Diamond=3]="Diamond",t[t.OpenArrow=4]="OpenArrow",t[t.ClosedArrow=5]="ClosedArrow",t[t.Butt=6]="Butt",t[t.ROpenArrow=7]="ROpenArrow",t[t.RClosedArrow=8]="RClosedArrow",t[t.Slash=9]="Slash",t[t.Unknown=10]="Unknown",t))(rs||{}),as=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PUSHBUTTON=1]="PUSHBUTTON",t[t.CHECKBOX=2]="CHECKBOX",t[t.RADIOBUTTON=3]="RADIOBUTTON",t[t.COMBOBOX=4]="COMBOBOX",t[t.LISTBOX=5]="LISTBOX",t[t.TEXTFIELD=6]="TEXTFIELD",t[t.SIGNATURE=7]="SIGNATURE",t[t.XFA=8]="XFA",t[t.XFA_CHECKBOX=9]="XFA_CHECKBOX",t[t.XFA_COMBOBOX=10]="XFA_COMBOBOX",t[t.XFA_IMAGEFIELD=11]="XFA_IMAGEFIELD",t[t.XFA_LISTBOX=12]="XFA_LISTBOX",t[t.XFA_PUSHBUTTON=13]="XFA_PUSHBUTTON",t[t.XFA_SIGNATURE=14]="XFA_SIGNATURE",t[t.XFA_TEXTFIELD=15]="XFA_TEXTFIELD",t))(as||{}),os=(t=>(t[t.Color=0]="Color",t[t.InteriorColor=1]="InteriorColor",t))(os||{}),ns=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.SOLID=1]="SOLID",t[t.DASHED=2]="DASHED",t[t.BEVELED=3]="BEVELED",t[t.INSET=4]="INSET",t[t.UNDERLINE=5]="UNDERLINE",t[t.CLOUDY=6]="CLOUDY",t))(ns||{}),ls=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.TEXT=1]="TEXT",t[t.PATH=2]="PATH",t[t.IMAGE=3]="IMAGE",t[t.SHADING=4]="SHADING",t[t.FORM=5]="FORM",t))(ls||{});const He=Object.freeze({1:"invisible",2:"hidden",4:"print",8:"noZoom",16:"noRotate",32:"noView",64:"readOnly",128:"locked",256:"toggleNoView"}),cs=Object.entries(He).reduce((t,[e,i])=>(t[i]=Number(e),t),{});function ra(t){return Object.keys(He).filter(e=>(t&e)!==0).map(e=>He[e])}function aa(t){return t.reduce((e,i)=>e|cs[i],0)}var us=(t=>(t[t.None=0]="None",t[t.MatchCase=1]="MatchCase",t[t.MatchWholeWord=2]="MatchWholeWord",t[t.MatchConsecutive=4]="MatchConsecutive",t))(us||{}),hs=(t=>(t[t.Display=0]="Display",t[t.Print=1]="Print",t))(hs||{}),Ve=(t=>(t[t.Ok=0]="Ok",t[t.Unknown=1]="Unknown",t[t.NotFound=2]="NotFound",t[t.WrongFormat=3]="WrongFormat",t[t.Password=4]="Password",t[t.Security=5]="Security",t[t.PageError=6]="PageError",t[t.XFALoad=7]="XFALoad",t[t.XFALayout=8]="XFALayout",t[t.Cancelled=9]="Cancelled",t[t.Initialization=10]="Initialization",t[t.NotReady=11]="NotReady",t[t.NotSupport=12]="NotSupport",t[t.LoadDoc=13]="LoadDoc",t[t.DocNotOpen=14]="DocNotOpen",t[t.CantCloseDoc=15]="CantCloseDoc",t[t.CantCreateNewDoc=16]="CantCreateNewDoc",t[t.CantImportPages=17]="CantImportPages",t[t.CantCreateAnnot=18]="CantCreateAnnot",t[t.CantSetAnnotRect=19]="CantSetAnnotRect",t[t.CantSetAnnotContent=20]="CantSetAnnotContent",t[t.CantRemoveInkList=21]="CantRemoveInkList",t[t.CantAddInkStoke=22]="CantAddInkStoke",t[t.CantReadAttachmentSize=23]="CantReadAttachmentSize",t[t.CantReadAttachmentContent=24]="CantReadAttachmentContent",t[t.CantFocusAnnot=25]="CantFocusAnnot",t[t.CantSelectText=26]="CantSelectText",t[t.CantSelectOption=27]="CantSelectOption",t[t.CantCheckField=28]="CantCheckField",t[t.CantSetAnnotString=29]="CantSetAnnotString",t))(Ve||{});class oa{static create(){return new P}static resolve(e){const i=new P;return i.resolve(e),i}static reject(e){const i=new P;return i.reject(e),i}static abort(e){const i=new P;return i.reject(e),i}}function na(t){const e=s=>Math.max(0,Math.min(255,s)),i=s=>e(s).toString(16).padStart(2,"0");return`#${i(t.red)}${i(t.green)}${i(t.blue)}`}function la(t){/^#?[0-9a-f]{3}$/i.test(t)&&(t=t.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3").toLowerCase());const[,e,i,s]=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t)??(()=>{throw new Error(`Invalid hex colour: "${t}"`)})();return{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16)}}function ca(t){return(i=>Math.max(0,Math.min(255,i)))(t)/255}function ua(t){return((i,s=255)=>Math.max(0,Math.min(s,i)))(Math.round(t*255))}function ha(t){if(!t?.startsWith("D:")||t.length<16)return;const e=+t.slice(2,6),i=+t.slice(6,8)-1,s=+t.slice(8,10),r=+t.slice(10,12),a=+t.slice(12,14),o=+t.slice(14,16);return new Date(Date.UTC(e,i,s,r,a,o))}function ga(t=new Date){const e=(l,c=2)=>l.toString().padStart(c,"0"),i=t.getUTCFullYear(),s=e(t.getUTCMonth()+1),r=e(t.getUTCDate()),a=e(t.getUTCHours()),o=e(t.getUTCMinutes()),n=e(t.getUTCSeconds());return`D:${i}${s}${r}${a}${o}${n}`}const Be=Object.freeze([{id:ye.Left,label:"Left",css:"left"},{id:ye.Center,label:"Center",css:"center"},{id:ye.Right,label:"Right",css:"right"}]);Be.reduce((t,e)=>(t[e.id]=e,t),{});Be.reduce((t,e)=>(t[e.css]=e.id,t),{});Be.map(t=>({value:t.id,label:t.label}));var yt=(t=>(t.Courier="Courier",t.Helvetica="Helvetica",t.Times="Times",t.Symbol="Symbol",t.ZapfDingbats="ZapfDingbats",t.Unknown="Unknown",t))(yt||{});D.Helvetica;const gs={id:D.Helvetica,family:"Helvetica",bold:!1,italic:!1,label:"Helvetica",css:"Helvetica, Arial, sans-serif"},Pe=Object.freeze([{id:D.Courier,family:"Courier",bold:!1,italic:!1,label:"Courier",css:"Courier, monospace"},{id:D.Courier_Bold,family:"Courier",bold:!0,italic:!1,label:"Courier Bold",css:'"Courier-Bold", Courier, monospace'},{id:D.Courier_BoldOblique,family:"Courier",bold:!0,italic:!0,label:"Courier Bold Oblique",css:'"Courier-BoldOblique", Courier, monospace'},{id:D.Courier_Oblique,family:"Courier",bold:!1,italic:!0,label:"Courier Oblique",css:'"Courier-Oblique", Courier, monospace'},gs,{id:D.Helvetica_Bold,family:"Helvetica",bold:!0,italic:!1,label:"Helvetica Bold",css:'"Helvetica-Bold", Arial, sans-serif'},{id:D.Helvetica_BoldOblique,family:"Helvetica",bold:!0,italic:!0,label:"Helvetica Bold Oblique",css:'"Helvetica-BoldOblique", Arial, sans-serif'},{id:D.Helvetica_Oblique,family:"Helvetica",bold:!1,italic:!0,label:"Helvetica Oblique",css:'"Helvetica-Oblique", Arial, sans-serif'},{id:D.Times_Roman,family:"Times",bold:!1,italic:!1,label:"Times Roman",css:'"Times New Roman", Times, serif'},{id:D.Times_Bold,family:"Times",bold:!0,italic:!1,label:"Times Bold",css:'"Times New Roman Bold", Times, serif'},{id:D.Times_BoldItalic,family:"Times",bold:!0,italic:!0,label:"Times Bold Italic",css:'"Times New Roman Bold Italic", Times, serif'},{id:D.Times_Italic,family:"Times",bold:!1,italic:!0,label:"Times Italic",css:'"Times New Roman Italic", Times, serif'},{id:D.Symbol,family:"Symbol",bold:!1,italic:!1,label:"Symbol",css:"Symbol"},{id:D.ZapfDingbats,family:"ZapfDingbats",bold:!1,italic:!1,label:"Zapf Dingbats",css:"ZapfDingbats"}]);Pe.reduce((t,e)=>(t[e.id]=e,t),{});const ds=new Map;for(const t of Pe)ds.set(`${t.family}_${t.bold}_${t.italic}`,t.id);Object.values(yt).filter(t=>t!=="Unknown").map(t=>({value:t,label:t}));[...new Set(Pe.map(t=>t.family))];const Xe=Object.freeze([{id:q.Normal,label:"Normal",css:"normal"},{id:q.Multiply,label:"Multiply",css:"multiply"},{id:q.Screen,label:"Screen",css:"screen"},{id:q.Overlay,label:"Overlay",css:"overlay"},{id:q.Darken,label:"Darken",css:"darken"},{id:q.Lighten,label:"Lighten",css:"lighten"},{id:q.ColorDodge,label:"Color Dodge",css:"color-dodge"},{id:q.ColorBurn,label:"Color Burn",css:"color-burn"},{id:q.HardLight,label:"Hard Light",css:"hard-light"},{id:q.SoftLight,label:"Soft Light",css:"soft-light"},{id:q.Difference,label:"Difference",css:"difference"},{id:q.Exclusion,label:"Exclusion",css:"exclusion"},{id:q.Hue,label:"Hue",css:"hue"},{id:q.Saturation,label:"Saturation",css:"saturation"},{id:q.Color,label:"Color",css:"color"},{id:q.Luminosity,label:"Luminosity",css:"luminosity"}]);Xe.reduce((t,e)=>(t[e.id]=e,t),{});Xe.reduce((t,e)=>(t[e.css]=e.id,t),{});Xe.map(t=>({value:t.id,label:t.label}));function st(t){if(t instanceof We)return{type:"noop"};if(t instanceof Hi)return{type:"console"};if(t instanceof Ai)return{type:"perf"};if(t instanceof Mi){const e=t;return{type:"level",config:{level:e.level,logger:st(e.logger)}}}return t instanceof Ui?{type:"all",config:{loggers:t.loggers.map(st)}}:{type:"noop"}}const ps=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function da(t){return ps.test(t)}function ms(t){var e;if(typeof((e=globalThis.crypto)==null?void 0:e.getRandomValues)=="function")return globalThis.crypto.getRandomValues(new Uint8Array(t));if(typeof require=="function")try{const{randomBytes:s}=require("crypto");return s(t)}catch{}const i=new Uint8Array(t);for(let s=0;s<t;s++)i[s]=Math.floor(Math.random()*256);return i}function pa(){var t;if(typeof((t=globalThis.crypto)==null?void 0:t.randomUUID)=="function")return globalThis.crypto.randomUUID();const e=ms(16);e[6]=e[6]&15|64,e[8]=e[8]&63|128;const i=Array.from(e,s=>s.toString(16).padStart(2,"0")).join("");return`${i.slice(0,8)}-${i.slice(8,12)}-${i.slice(12,16)}-${i.slice(16,20)}-${i.slice(20)}`}function wt(){}const fs="https://cdn.jsdelivr.net/npm/@embedpdf/pdfium@1.4.1/dist/pdfium.wasm",f="WebWorkerEngine",v="Engine";function S(t,e,i){return{id:t,type:"ExecuteRequest",data:{name:e,args:i}}}class w extends P{constructor(e,i){super(),this.worker=e,this.messageId=i}abort(e){super.abort(e),this.worker.postMessage({id:this.messageId,type:"AbortRequest"})}progress(e){super.progress(e)}}const bt=class Me{constructor(e,i=new We){this.worker=e,this.logger=i,this.tasks=new Map,this.handle=s=>{this.logger.debug(f,v,"webworker engine start handling message: ",s.data);try{const r=s.data,a=this.tasks.get(r.id);if(!a)return;switch(r.type){case"ReadyResponse":this.readyTask.resolve(!0);break;case"ExecuteProgress":a.progress(r.data);break;case"ExecuteResponse":{switch(r.data.type){case"result":a.resolve(r.data.value);break;case"error":a.reject(r.data.value.reason);break}this.tasks.delete(r.id)}break}}catch(r){this.logger.error(f,v,"webworker met error when handling message: ",r)}},this.worker.addEventListener("message",this.handle),this.readyTask=new w(this.worker,Me.readyTaskId),this.tasks.set(Me.readyTaskId,this.readyTask)}generateRequestId(e){return`${e}.${Date.now()}.${Math.random()}`}initialize(){this.logger.debug(f,v,"initialize");const e=this.generateRequestId("General"),i=new w(this.worker,e),s=S(e,"initialize",[]);return this.proxy(i,s),i}destroy(){this.logger.debug(f,v,"destroy");const e=this.generateRequestId("General"),i=new w(this.worker,e),s=()=>{this.worker.removeEventListener("message",this.handle),this.worker.terminate()};i.wait(s,s);const r=S(e,"destroy",[]);return this.proxy(i,r),i}openDocumentUrl(e,i){this.logger.debug(f,v,"openDocumentUrl",e.url,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"openDocumentUrl",[e,i]);return this.proxy(r,a),r}openDocumentBuffer(e,i){this.logger.debug(f,v,"openDocumentBuffer",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"openDocumentBuffer",[e,i]);return this.proxy(r,a),r}getMetadata(e){this.logger.debug(f,v,"getMetadata",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getMetadata",[e]);return this.proxy(s,r),s}setMetadata(e,i){this.logger.debug(f,v,"setMetadata",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"setMetadata",[e,i]);return this.proxy(r,a),r}getDocPermissions(e){this.logger.debug(f,v,"getDocPermissions",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getDocPermissions",[e]);return this.proxy(s,r),s}getDocUserPermissions(e){this.logger.debug(f,v,"getDocUserPermissions",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getDocUserPermissions",[e]);return this.proxy(s,r),s}getBookmarks(e){this.logger.debug(f,v,"getBookmarks",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getBookmarks",[e]);return this.proxy(s,r),s}setBookmarks(e,i){this.logger.debug(f,v,"setBookmarks",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"setBookmarks",[e,i]);return this.proxy(r,a),r}deleteBookmarks(e){this.logger.debug(f,v,"deleteBookmarks",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"deleteBookmarks",[e]);return this.proxy(s,r),s}getSignatures(e){this.logger.debug(f,v,"getSignatures",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getSignatures",[e]);return this.proxy(s,r),s}renderPage(e,i,s){this.logger.debug(f,v,"renderPage",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"renderPage",[e,i,s]);return this.proxy(a,o),a}renderPageRect(e,i,s,r){this.logger.debug(f,v,"renderPageRect",e,i,s,r);const a=this.generateRequestId(e.id),o=new w(this.worker,a),n=S(a,"renderPageRect",[e,i,s,r]);return this.proxy(o,n),o}renderPageAnnotation(e,i,s,r){this.logger.debug(f,v,"renderAnnotation",e,i,s,r);const a=this.generateRequestId(e.id),o=new w(this.worker,a),n=S(a,"renderPageAnnotation",[e,i,s,r]);return this.proxy(o,n),o}getAllAnnotations(e){this.logger.debug(f,v,"getAllAnnotations",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getAllAnnotations",[e]);return this.proxy(s,r),s}getPageAnnotations(e,i){this.logger.debug(f,v,"getPageAnnotations",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"getPageAnnotations",[e,i]);return this.proxy(r,a),r}createPageAnnotation(e,i,s,r){this.logger.debug(f,v,"createPageAnnotations",e,i,s,r);const a=this.generateRequestId(e.id),o=new w(this.worker,a),n=S(a,"createPageAnnotation",[e,i,s,r]);return this.proxy(o,n),o}updatePageAnnotation(e,i,s){this.logger.debug(f,v,"updatePageAnnotation",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"updatePageAnnotation",[e,i,s]);return this.proxy(a,o),a}removePageAnnotation(e,i,s){this.logger.debug(f,v,"removePageAnnotations",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"removePageAnnotation",[e,i,s]);return this.proxy(a,o),a}getPageTextRects(e,i){this.logger.debug(f,v,"getPageTextRects",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"getPageTextRects",[e,i]);return this.proxy(r,a),r}renderThumbnail(e,i,s){this.logger.debug(f,v,"renderThumbnail",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"renderThumbnail",[e,i,s]);return this.proxy(a,o),a}searchAllPages(e,i,s){this.logger.debug(f,v,"searchAllPages",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"searchAllPages",[e,i,s]);return this.proxy(a,o),a}saveAsCopy(e){this.logger.debug(f,v,"saveAsCopy",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"saveAsCopy",[e]);return this.proxy(s,r),s}getAttachments(e){this.logger.debug(f,v,"getAttachments",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"getAttachments",[e]);return this.proxy(s,r),s}addAttachment(e,i){this.logger.debug(f,v,"addAttachment",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"addAttachment",[e,i]);return this.proxy(r,a),r}removeAttachment(e,i){this.logger.debug(f,v,"removeAttachment",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"removeAttachment",[e,i]);return this.proxy(r,a),r}readAttachmentContent(e,i){this.logger.debug(f,v,"readAttachmentContent",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"readAttachmentContent",[e,i]);return this.proxy(r,a),r}setFormFieldValue(e,i,s,r){this.logger.debug(f,v,"setFormFieldValue",e,s,r);const a=this.generateRequestId(e.id),o=new w(this.worker,a),n=S(a,"setFormFieldValue",[e,i,s,r]);return this.proxy(o,n),o}flattenPage(e,i,s){this.logger.debug(f,v,"flattenPage",e,i,s);const r=this.generateRequestId(e.id),a=new w(this.worker,r),o=S(r,"flattenPage",[e,i,s]);return this.proxy(a,o),a}extractPages(e,i){this.logger.debug(f,v,"extractPages",e);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"extractPages",[e,i]);return this.proxy(r,a),r}redactTextInRects(e,i,s,r){this.logger.debug(f,v,"redactTextInRects",e,i,s,r);const a=this.generateRequestId(e.id),o=new w(this.worker,a),n=S(a,"redactTextInRects",[e,i,s,r]);return this.proxy(o,n),o}extractText(e,i){this.logger.debug(f,v,"extractText",e);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"extractText",[e,i]);return this.proxy(r,a),r}getTextSlices(e,i){this.logger.debug(f,v,"getTextSlices",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"getTextSlices",[e,i]);return this.proxy(r,a),r}getPageGlyphs(e,i){this.logger.debug(f,v,"getPageGlyphs",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"getPageGlyphs",[e,i]);return this.proxy(r,a),r}getPageGeometry(e,i){this.logger.debug(f,v,"getPageGeometry",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"getPageGeometry",[e,i]);return this.proxy(r,a),r}merge(e){this.logger.debug(f,v,"merge",e);const i=e.map(o=>o.id).join("."),s=this.generateRequestId(i),r=new w(this.worker,s),a=S(s,"merge",[e]);return this.proxy(r,a),r}mergePages(e){this.logger.debug(f,v,"mergePages",e);const i=this.generateRequestId(e.map(a=>a.docId).join(".")),s=new w(this.worker,i),r=S(i,"mergePages",[e]);return this.proxy(s,r),s}preparePrintDocument(e,i){this.logger.debug(f,v,"preparePrintDocument",e,i);const s=this.generateRequestId(e.id),r=new w(this.worker,s),a=S(s,"preparePrintDocument",[e,i]);return this.proxy(r,a),r}closeDocument(e){this.logger.debug(f,v,"closeDocument",e);const i=this.generateRequestId(e.id),s=new w(this.worker,i),r=S(i,"closeDocument",[e]);return this.proxy(s,r),s}closeAllDocuments(){this.logger.debug(f,v,"closeAllDocuments");const e=this.generateRequestId("closeAllDocuments"),i=new w(this.worker,e),s=S(e,"closeAllDocuments",[]);return this.proxy(i,s),i}proxy(e,i,s=[]){this.logger.debug(f,v,"send request to worker",e,i,s),this.logger.perf(f,v,`${i.data.name}`,"Begin",i.id),this.readyTask.wait(()=>{this.worker.postMessage(i,s),e.wait(()=>{this.logger.perf(f,v,`${i.data.name}`,"End",i.id)},()=>{this.logger.perf(f,v,`${i.data.name}`,"End",i.id)}),this.tasks.set(i.id,e)},()=>{this.logger.perf(f,v,`${i.data.name}`,"End",i.id),e.reject({code:Ve.Initialization,message:"worker initialization failed"})})}};bt.readyTaskId="0";let ma=bt;function vs(t){const{wasmUrl:e=fs,worker:i=!0,logger:s}={},r=J({engine:null,isLoading:!0,error:null});let a=ee(null);return typeof window<"u"&&G(()=>{let n=!1;return(async()=>{try{const{createPdfiumEngine:l}=i?await it(()=>import("./KONR6dtX.js"),[],import.meta.url):await it(()=>import("./Cex3JoSC.js"),[],import.meta.url),c=await l(e,s);F(a,c,!0),c.initialize().wait(()=>{r.engine=c,r.isLoading=!1},u=>{r.error=new Error(u.reason.message),r.isLoading=!1})}catch(l){n||(r.error=l,r.isLoading=!1)}})(),()=>{var l,c;n=!0,(c=(l=b(a))==null?void 0:l.closeAllDocuments)==null||c.call(l).wait(()=>{var u,h;(h=(u=b(a))==null?void 0:u.destroy)==null||h.call(u),F(a,null)},wt)}}),r}class rt{constructor(){this.dependencyGraph=new Map}addNode(e,i=[]){this.dependencyGraph.set(e,new Set(i))}hasCircularDependencies(){const e=new Set,i=new Set,s=r=>{e.add(r),i.add(r);const a=this.dependencyGraph.get(r)||new Set;for(const o of a)if(e.has(o)){if(i.has(o))return!0}else if(s(o))return!0;return i.delete(r),!1};for(const r of this.dependencyGraph.keys())if(!e.has(r)&&s(r))return!0;return!1}resolveLoadOrder(){if(this.hasCircularDependencies())throw new Error("Circular dependencies detected");const e=[],i=new Set,s=new Set,r=a=>{if(s.has(a))throw new Error("Circular dependency");if(i.has(a))return;s.add(a);const o=this.dependencyGraph.get(a)||new Set;for(const n of o)r(n);s.delete(a),i.add(a),e.push(a)};for(const a of this.dependencyGraph.keys())i.has(a)||r(a);return e}}class $ extends Error{constructor(e){super(e),this.name="PluginRegistrationError"}}class re extends Error{constructor(e){super(e),this.name="PluginNotFoundError"}}class ys extends Error{constructor(e){super(e),this.name="CircularDependencyError"}}class ws extends Error{constructor(e){super(e),this.name="PluginConfigurationError"}}class bs{constructor(e,i){this.store=e,this.pluginId=i}getState(){return this.store.getState().plugins[this.pluginId]}dispatch(e){return this.store.dispatchToPlugin(this.pluginId,e)}subscribeToState(e){return this.store.subscribeToPlugin(this.pluginId,(i,s,r)=>{e(i,s,r)})}onAction(e,i){return this.store.onAction(e,(s,r,a)=>{i(s,r.plugins[this.pluginId],a.plugins[this.pluginId])})}}const Ze="LOAD_DOCUMENT",St="REFRESH_DOCUMENT",Ss="REFRESH_PAGES",pe="SET_DOCUMENT",Rt="SET_DOCUMENT_ERROR",be="SET_SCALE",Se="SET_ROTATION",Re="SET_PAGES",Rs=[Ze,St,pe,Rt,be,Se,Re],Cs=()=>({type:Ze}),Ts=t=>({type:pe,payload:t}),xs=t=>({type:be,payload:t});class ks{constructor(e,i){this.initialCoreState=i,this.pluginReducers={},this.listeners=[],this.pluginListeners={},this.isDispatching=!1,this.state={core:i,plugins:{}},this.coreReducer=e}addPluginReducer(e,i,s){this.state.plugins[e]=s,this.pluginReducers[e]=i}dispatchToCore(e){if(!this.coreReducer)return this.getState();if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const i=this.getState();try{this.isDispatching=!0,this.state.core=this.coreReducer(this.state.core,e)}finally{this.isDispatching=!1}return this.listeners.forEach(s=>{const r=this.getState();s(e,r,i)}),this.getState()}dispatchToPlugin(e,i,s=!0){if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const r=this.getState(),a=this.pluginReducers[e];if(!a)return r.plugins[e];const o=r.plugins[e];try{this.isDispatching=!0;const n=a(o,i);this.state.plugins[e]=n}finally{this.isDispatching=!1}return s&&this.listeners.forEach(n=>{const l=this.getState();n(i,l,r)}),this.pluginListeners[e]&&this.pluginListeners[e].forEach(n=>{const l=this.getState().plugins[e];n(i,l,o)}),this.getState().plugins[e]}dispatch(e){if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const i=this.getState();try{this.isDispatching=!0,this.isCoreAction(e)&&(this.state.core=this.coreReducer(this.state.core,e));for(const s in this.pluginReducers){const r=this.pluginReducers[s],a=i.plugins[s];r&&(this.state.plugins[s]=r(a,e))}}finally{this.isDispatching=!1}return this.listeners.forEach(s=>{const r=this.getState();s(e,r,i)}),this.getState()}getState(){if(this.isDispatching)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return{core:{...this.state.core},plugins:{...this.state.plugins}}}subscribe(e){if(this.isDispatching)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state.");return this.listeners.push(e),()=>{if(this.isDispatching)throw new Error("You may not unsubscribe from a store listener while the reducer is executing.");this.listeners=this.listeners.filter(i=>i!==e)}}subscribeToPlugin(e,i){if(!(e in this.state.plugins))throw new Error(`Plugin state not found for plugin "${e}". Did you forget to call addPluginReducer?`);if(this.isDispatching)throw new Error("You may not call store.subscribeToPlugin() while the reducer is executing.");return this.pluginListeners[e]||(this.pluginListeners[e]=[]),this.pluginListeners[e].push(i),()=>{if(this.isDispatching)throw new Error("You may not unsubscribe from a store listener while the reducer is executing.");this.pluginListeners[e]=this.pluginListeners[e].filter(s=>s!==i),this.pluginListeners[e].length===0&&delete this.pluginListeners[e]}}onAction(e,i){return this.subscribe((s,r,a)=>{s.type===e&&i(s,r,a)})}getPluginStore(e){if(!(e in this.state.plugins))throw new Error(`Plugin state not found for plugin "${e}". Did you forget to call addPluginReducer?`);return new bs(this,e)}isCoreAction(e){return Rs.includes(e.type)}destroy(){var e,i;this.listeners.length=0;for(const s in this.pluginListeners)(i=(e=this.pluginListeners[s])==null?void 0:e.splice)==null||i.call(e,0);this.pluginListeners={},this.pluginReducers={},this.state.plugins={},this.state.core={...this.initialCoreState}}}const Ls=t=>({scale:t?.scale??1,rotation:t?.rotation??Ge.Degree0,document:null,pages:[],loading:!1,error:null}),he=t=>t.pages.map(e=>e.map(i=>({...i,rotatedSize:qi(i.size,t.rotation,1)}))),Es=(t,e)=>{switch(e.type){case Ze:return{...t,loading:!0,error:null};case pe:return{...t,document:e.payload,pages:e.payload.pages.map(i=>[i]),loading:!1,error:null};case St:return{...t,document:e.payload,pages:e.payload.pages.map(i=>[i]),loading:!1,error:null};case Se:return{...t,rotation:e.payload};case Re:return{...t,pages:e.payload};case Rt:return{...t,loading:!1,error:e.payload};case be:return{...t,scale:e.payload};default:return t}};class _s{constructor(e,i){this.plugins=new Map,this.manifests=new Map,this.capabilities=new Map,this.status=new Map,this.configurations=new Map,this.engineInitialized=!1,this.initPromise=null,this.pendingRegistrations=[],this.processingRegistrations=[],this.initialized=!1,this.isInitializing=!1,this.pluginsReadyPromise=null,this.destroyed=!1,this.resolver=new rt,this.engine=e,this.initialCoreState=Ls(i),this.store=new ks(Es,this.initialCoreState),this.logger=i?.logger??new We}getLogger(){return this.logger}async ensureEngineInitialized(){this.engineInitialized||(this.engine.initialize?(await this.engine.initialize().toPromise(),this.engineInitialized=!0):this.engineInitialized=!0)}registerPlugin(e,i){if(this.initialized&&!this.isInitializing)throw new $("Cannot register plugins after initialization");this.validateManifest(e.manifest),this.store.addPluginReducer(e.manifest.id,e.reducer,typeof e.initialState=="function"?e.initialState(this.initialCoreState,{...e.manifest.defaultConfig,...i}):e.initialState),this.pendingRegistrations.push({package:e,config:i})}getStore(){return this.store}getEngine(){return this.engine}pluginsReady(){return this.pluginsReadyPromise?this.pluginsReadyPromise:(this.pluginsReadyPromise=(async()=>{this.initialized||await this.initialize();const e=Array.from(this.plugins.values()).map(i=>typeof i.ready=="function"?i.ready():Promise.resolve());await Promise.all(e)})(),this.pluginsReadyPromise)}async initialize(){if(this.destroyed)throw new $("Registry has been destroyed");return this.initPromise?this.initPromise:(this.initPromise=(async()=>{var e;if(this.initialized)throw new $("Registry is already initialized");this.isInitializing=!0;try{if(await this.ensureEngineInitialized(),this.destroyed)return;for(;this.pendingRegistrations.length>0;){if(this.destroyed)return;this.processingRegistrations=[...this.pendingRegistrations],this.pendingRegistrations=[];for(const s of this.processingRegistrations){const r=new Set,a=[...s.package.manifest.requires,...s.package.manifest.optional];for(const o of a){const n=this.processingRegistrations.find(l=>l.package.manifest.provides.includes(o));n&&r.add(n.package.manifest.id)}this.resolver.addNode(s.package.manifest.id,[...r])}const i=this.resolver.resolveLoadOrder();for(const s of i){const r=this.processingRegistrations.find(a=>a.package.manifest.id===s);await this.initializePlugin(r.package.manifest,r.package.create,r.config)}this.processingRegistrations=[],this.resolver=new rt}for(const i of this.plugins.values())await((e=i.postInitialize)==null?void 0:e.call(i).catch(s=>{console.error(`Error in postInitialize for plugin ${i.id}`,s),this.status.set(i.id,"error")}));this.initialized=!0}catch(i){throw i instanceof Error?new ys(`Failed to resolve plugin dependencies: ${i.message}`):i}finally{this.isInitializing=!1}})(),this.initPromise)}async initializePlugin(e,i,s){const r={...e.defaultConfig,...s};this.validateConfig(e.id,r,e.defaultConfig);const a=i(this,r);this.validatePlugin(a);for(const o of e.requires)if(!this.capabilities.has(o))throw new $(`Missing required capability: ${o} for plugin ${e.id}`);for(const o of e.optional)this.capabilities.has(o)&&this.logger.debug("PluginRegistry","OptionalCapability",`Optional capability ${o} is available for plugin ${e.id}`);this.logger.debug("PluginRegistry","InitializePlugin",`Initializing plugin ${e.id}`,{provides:e.provides});for(const o of e.provides){if(this.capabilities.has(o))throw new $(`Capability ${o} is already provided by plugin ${this.capabilities.get(o)}`);this.capabilities.set(o,e.id)}this.plugins.set(e.id,a),this.manifests.set(e.id,e),this.status.set(e.id,"registered"),this.configurations.set(e.id,r);try{a.initialize&&await a.initialize(r),this.status.set(e.id,"active"),this.logger.info("PluginRegistry","PluginInitialized",`Plugin ${e.id} initialized successfully`)}catch(o){throw this.plugins.delete(e.id),this.manifests.delete(e.id),this.logger.error("PluginRegistry","InitializationFailed",`Plugin ${e.id} initialization failed`,{provides:e.provides,error:o}),e.provides.forEach(n=>this.capabilities.delete(n)),o}}getPluginConfig(e){const i=this.configurations.get(e);if(!i)throw new re(`Configuration for plugin ${e} not found`);return i}validateConfig(e,i,s){const a=Object.keys(s).filter(o=>!i.hasOwnProperty(o));if(a.length>0)throw new ws(`Missing required configuration keys for plugin ${e}: ${a.join(", ")}`)}async updatePluginConfig(e,i){const s=this.getPlugin(e);if(!s)throw new re(`Plugin ${e} not found`);const r=this.manifests.get(e),a=this.configurations.get(e);if(!r||!a)throw new re(`Plugin ${e} not found`);const o={...a,...i};this.validateConfig(e,o,r.defaultConfig),this.configurations.set(e,o),s.initialize&&await s.initialize(o)}registerPluginBatch(e){for(const i of e)this.registerPlugin(i.package,i.config)}async unregisterPlugin(e){const i=this.plugins.get(e);if(!i)throw new re(`Plugin ${e} is not registered`);const s=this.manifests.get(e);if(!s)throw new re(`Manifest for plugin ${e} not found`);for(const[r,a]of this.manifests.entries()){if(r===e)continue;if([...a.requires,...a.optional].some(n=>s.provides.includes(n)))throw new $(`Cannot unregister plugin ${e}: plugin ${r} depends on it`)}try{i.destroy&&await i.destroy();for(const r of s.provides)this.capabilities.delete(r);this.plugins.delete(e),this.manifests.delete(e),this.status.delete(e)}catch(r){throw r instanceof Error?new Error(`Failed to unregister plugin ${e}: ${r.message}`):r}}getPlugin(e){const i=this.plugins.get(e);return i||null}getCapabilityProvider(e){const i=this.capabilities.get(e);return i?this.getPlugin(i):null}hasCapability(e){return this.capabilities.has(e)}getAllPlugins(){return Array.from(this.plugins.values())}getPluginStatus(e){const i=this.status.get(e);if(!i)throw new re(`Plugin ${e} not found`);return i}validatePlugin(e){if(!e.id)throw new $("Plugin must have an id")}validateManifest(e){if(!e.id)throw new $("Manifest must have an id");if(!e.name)throw new $("Manifest must have a name");if(!e.version)throw new $("Manifest must have a version");if(!Array.isArray(e.provides))throw new $("Manifest must have a provides array");if(!Array.isArray(e.requires))throw new $("Manifest must have a requires array");if(!Array.isArray(e.optional))throw new $("Manifest must have an optional array")}isDestroyed(){return this.destroyed}async destroy(){var e;if(this.destroyed)throw new $("Registry has already been destroyed");this.destroyed=!0;try{await this.initPromise}catch{}for(const i of Array.from(this.plugins.values()).reverse())await((e=i.destroy)==null?void 0:e.call(i));this.store.destroy(),this.plugins.clear(),this.manifests.clear(),this.capabilities.clear(),this.status.clear(),this.pendingRegistrations.length=0,this.processingRegistrations.length=0}}function ue(t,e){return{package:t,config:e}}function Is(t){return"autoMountElements"in t&&typeof t.autoMountElements=="function"}class me{constructor(e,i){if(this.id=e,this.registry=i,this.cooldownActions={},this.debouncedTimeouts={},this.unsubscribeFromState=null,this.unsubscribeFromCoreStore=null,e!==this.constructor.id)throw new Error(`Plugin ID mismatch: ${e} !== ${this.constructor.id}`);this.engine=this.registry.getEngine(),this.logger=this.registry.getLogger(),this.coreStore=this.registry.getStore(),this.pluginStore=this.coreStore.getPluginStore(this.id),this.unsubscribeFromState=this.pluginStore.subscribeToState((s,r,a)=>{this.onStoreUpdated(a,r)}),this.unsubscribeFromCoreStore=this.coreStore.subscribe((s,r,a)=>{this.onCoreStoreUpdated(a,r)}),this.readyPromise=new Promise(s=>{this.readyResolve=s}),this.readyResolve()}provides(){if(!this._capability){const e=this.buildCapability();this._capability=Object.freeze(e)}return this._capability}get state(){return this.pluginStore.getState()}get coreState(){return this.coreStore.getState()}getState(){return this.pluginStore.getState()}getCoreState(){return this.coreStore.getState()}dispatchCoreAction(e){return this.coreStore.dispatchToCore(e)}dispatchToAllPlugins(e){return this.coreStore.dispatch(e)}dispatch(e){return this.pluginStore.dispatch(e)}cooldownDispatch(e,i=100){const s=Date.now(),r=this.cooldownActions[e.type]||0;return s-r>=i?(this.cooldownActions[e.type]=s,this.dispatch(e),!0):!1}debouncedDispatch(e,i=100){const s=e.type;this.debouncedTimeouts[s]&&clearTimeout(this.debouncedTimeouts[s]),this.debouncedTimeouts[s]=setTimeout(()=>{this.dispatch(e),delete this.debouncedTimeouts[s]},i)}cancelDebouncedDispatch(e){this.debouncedTimeouts[e]&&(clearTimeout(this.debouncedTimeouts[e]),delete this.debouncedTimeouts[e])}subscribe(e){return this.pluginStore.subscribeToState(e)}subscribeToCoreStore(e){return this.coreStore.subscribe(e)}onStoreUpdated(e,i){}onCoreStoreUpdated(e,i){}destroy(){Object.values(this.debouncedTimeouts).forEach(e=>{clearTimeout(e)}),this.debouncedTimeouts={},this.unsubscribeFromState&&(this.unsubscribeFromState(),this.unsubscribeFromState=null),this.unsubscribeFromCoreStore&&(this.unsubscribeFromCoreStore(),this.unsubscribeFromCoreStore=null)}ready(){return this.readyPromise}markReady(){this.readyResolve()}resetReady(){this.readyPromise=new Promise(e=>{this.readyResolve=e})}}class zs{constructor(e,i){this.handler=e,this.options=i,this.lastRun=0,this.handle=s=>{this.options.mode==="debounce"?this.debounce(s):this.throttle(s)}}debounce(e){this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.timeoutId=void 0},this.options.wait)}throttle(e){if(this.options.mode==="debounce")return;const i=Date.now(),s=this.options.throttleMode||"leading-trailing";i-this.lastRun>=this.options.wait&&(s==="leading-trailing"&&this.handler(e),this.lastRun=i),this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.lastRun=Date.now(),this.timeoutId=void 0},this.options.wait-(i-this.lastRun))}destroy(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}function we(t,e,i){return t<e?e:t>i?i:t}function de(t,e,i){if(t===e)return!0;if(t==null||e==null)return t===e;const s=typeof t;if(s!==typeof e)return!1;if(s==="object"){i||(i=new Set);const a=qs(t,e);if(i.has(a))return!0;i.add(a);const o=Array.isArray(t),n=Array.isArray(e);return o&&n?Ns(t,e,i):!o&&!n?Os(t,e,i):!1}return!1}function qs(t,e){return`${at(t)}__${at(e)}`}let Ds=0;const _e=new WeakMap;function at(t){return _e.has(t)||_e.set(t,++Ds),_e.get(t)}function Ns(t,e,i){if(t.length!==e.length)return!1;const s=new Array(e.length).fill(!1);e:for(let r=0;r<t.length;r++){const a=t[r];for(let o=0;o<e.length;o++)if(!s[o]&&de(a,e[o],i)){s[o]=!0;continue e}return!1}return!0}function Os(t,e,i){const s=Object.keys(t).sort(),r=Object.keys(e).sort();if(s.length!==r.length)return!1;for(let a=0;a<s.length;a++)if(s[a]!==r[a])return!1;for(const a of s){const o=t[a],n=e[a];if(!de(o,n,i))return!1}return!0}function Ce(){const t=new Set;return{emit:(i=void 0)=>t.forEach(s=>s(i)),on:i=>(t.add(i),()=>t.delete(i)),off:i=>t.delete(i),clear:()=>t.clear()}}function M(t,e=de){const i=new Set,s=new Map;let r=t;const a=n=>i.forEach(l=>l(n)),o=(n,l)=>{let c=n,u=()=>{};if(l){const h=new zs(n,l);c=h.handle,u=()=>h.destroy(),s.set(n,{wrapped:c,destroy:u})}return r!==void 0&&c(r),i.add(c),()=>{i.delete(c),u(),s.delete(n)}};return{get value(){return r},emit(n=void 0){(r===void 0||!e(r,n))&&(r=n,a(n))},on:o,off(n){const l=s.get(n);l?(i.delete(l.wrapped),l.destroy(),s.delete(n)):i.delete(n)},clear(){i.clear(),s.forEach(n=>n.destroy()),s.clear()},select(n,l=de){return(c,u)=>{let h;if(r!==void 0){const g=n(r);h=g,c(g)}return o(g=>{const d=n(g);(h===void 0||!l(h,d))&&(h=d,c(d))},u)}}}}class $s{constructor(e){this.autoMountElements=[],this.package=e}addUtility(e){return this.autoMountElements.push({component:e,type:"utility"}),this}addWrapper(e){return this.autoMountElements.push({component:e,type:"wrapper"}),this}build(){return{...this.package,autoMountElements:()=>this.autoMountElements}}}function Hs(t){return new $s(t)}const W=J({registry:null,isInitializing:!0,pluginsReady:!1}),Ms=()=>W;function Te(t){const{registry:e}=W,i=J({plugin:null,isLoading:!0,ready:new Promise(()=>{})});if(e===null)return i;const s=e.getPlugin(t);if(!s)throw new Error(`Plugin ${t} not found`);return i.plugin=s,i.isLoading=!1,i.ready=s.ready(),i}function je(t){const e=Te(t),i=J({provides:null,isLoading:!0,ready:new Promise(()=>{})});return G(()=>{if(!e.plugin){i.provides=null,i.isLoading=e.isLoading,i.ready=e.ready;return}if(!e.plugin.provides)throw new Error(`Plugin ${t} does not provide a capability`);i.provides=e.plugin.provides(),i.isLoading=e.isLoading,i.ready=e.ready}),i}function As(){const{registry:t}=Ms(),e=J({coreState:null});return G(()=>{if(!t)return;const i=t.getStore();return e.coreState=i.getState().core,i.subscribe((s,r,a)=>{i.isCoreAction(s)&&!de(r.core,a.core)&&(e.coreState=r.core)})}),e}function Ct(t,e){X(e,!0);var i=A(),s=O(i);{var r=o=>{const n=ne(()=>e.wrappers[0]);var l=A(),c=O(l);Ne(c,()=>b(n),(u,h)=>{h(u,{children:(g,d)=>{{let p=ne(()=>e.wrappers.slice(1));Ct(g,{get wrappers(){return b(p)},children:(R,_)=>{var m=A(),y=O(m);Y(y,()=>e.children??le),L(R,m)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),L(o,l)},a=o=>{const n=ne(()=>e.wrappers[0]);var l=A(),c=O(l);Ne(c,()=>b(n),(u,h)=>{h(u,{children:(g,d)=>{var p=A(),R=O(p);Y(R,()=>e.children??le),L(g,p)},$$slots:{default:!0}})}),L(o,l)};te(s,o=>{e.wrappers.length>1?o(r):o(a,!1)})}L(t,i),Z()}var Us=V("<!> <!>",1);function Gs(t,e){X(e,!0);let i=ee(J([])),s=ee(J([]));G(()=>{var c;const u=[],h=[];for(const g of e.plugins){const d=g.package;if(Is(d)){const p=((c=d.autoMountElements)==null?void 0:c.call(d))??[];for(const R of p)R.type==="utility"?u.push(R.component):R.type==="wrapper"&&h.push(R.component)}}F(i,u,!0),F(s,h,!0)});var r=Us(),a=O(r);{var o=c=>{Ct(c,{get wrappers(){return b(s)},get children(){return e.children}})},n=c=>{var u=A(),h=O(u);Y(h,()=>e.children??le),L(c,u)};te(a,c=>{b(s).length>0?c(o):c(n,!1)})}var l=oe(a,2);ve(l,19,()=>b(i),(c,u)=>`utility-${u}`,(c,u)=>{var h=A(),g=O(h);Ne(g,()=>b(u),(d,p)=>{p(d,{})}),L(c,h)}),L(t,r),Z()}function Ws(t,e){X(e,!0);let i=Ri(e,"autoMountDomElements",3,!0),s=e.onInitialized;G(()=>{e.onInitialized&&(s=e.onInitialized)}),G(()=>{if(e.engine||e.engine&&e.plugins){const l=new _s(e.engine,{logger:e.logger});return l.registerPluginBatch(e.plugins),(async()=>{await l.initialize(),!l.isDestroyed()&&(await s?.(l),!l.isDestroyed()&&(l.pluginsReady().then(()=>{l.isDestroyed()||(W.pluginsReady=!0)}),W.registry=l,W.isInitializing=!1))})().catch(console.error),()=>{l.destroy(),W.registry=null,W.isInitializing=!1,W.pluginsReady=!1}}});var r=A(),a=O(r);{var o=l=>{Gs(l,{get plugins(){return e.plugins},children:(c,u)=>{var h=A(),g=O(h);Y(g,()=>e.children,()=>W),L(c,h)},$$slots:{default:!0}})},n=l=>{var c=A(),u=O(c);Y(u,()=>e.children,()=>W),L(l,c)};te(a,l=>{W.pluginsReady&&i()?l(o):l(n,!1)})}L(t,r),Z()}const Tt="viewport",Vs={id:Tt,name:"Viewport Plugin",version:"1.0.0",provides:["viewport"],requires:[],optional:[],defaultConfig:{enabled:!0,viewportGap:10,scrollEndDelay:300}},xt="SET_VIEWPORT_METRICS",kt="SET_VIEWPORT_SCROLL_METRICS",Lt="SET_VIEWPORT_GAP",Et="SET_SCROLL_ACTIVITY",_t="SET_SMOOTH_SCROLL_ACTIVITY";function Bs(t){return{type:Lt,payload:t}}function Ps(t){return{type:xt,payload:t}}function Xs(t){return{type:kt,payload:t}}function Zs(t){return{type:Et,payload:t}}function ot(t){return{type:_t,payload:t}}const It={viewportGap:0,viewportMetrics:{width:0,height:0,scrollTop:0,scrollLeft:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0,relativePosition:{x:0,y:0}},isScrolling:!1,isSmoothScrolling:!1},js=(t=It,e)=>{switch(e.type){case Lt:return{...t,viewportGap:e.payload};case xt:return{...t,viewportMetrics:{width:e.payload.width,height:e.payload.height,scrollTop:e.payload.scrollTop,scrollLeft:e.payload.scrollLeft,clientWidth:e.payload.clientWidth,clientHeight:e.payload.clientHeight,scrollWidth:e.payload.scrollWidth,scrollHeight:e.payload.scrollHeight,relativePosition:{x:e.payload.scrollWidth<=e.payload.clientWidth?0:e.payload.scrollLeft/(e.payload.scrollWidth-e.payload.clientWidth),y:e.payload.scrollHeight<=e.payload.clientHeight?0:e.payload.scrollTop/(e.payload.scrollHeight-e.payload.clientHeight)}}};case kt:return{...t,viewportMetrics:{...t.viewportMetrics,scrollTop:e.payload.scrollTop,scrollLeft:e.payload.scrollLeft},isScrolling:!0};case Et:return{...t,isScrolling:e.payload};case _t:return{...t,isSmoothScrolling:e.payload};default:return t}},zt=class extends me{constructor(e,i,s){super(e,i),this.id=e,this.viewportResize$=M(),this.viewportMetrics$=M(),this.scrollMetrics$=M(),this.scrollReq$=Ce(),this.scrollActivity$=M(),this.rectProvider=null,s.viewportGap&&this.dispatch(Bs(s.viewportGap)),this.scrollEndDelay=s.scrollEndDelay||100}buildCapability(){return{getViewportGap:()=>this.state.viewportGap,getMetrics:()=>this.state.viewportMetrics,getBoundingRect:()=>{var e;return((e=this.rectProvider)==null?void 0:e.call(this))??{origin:{x:0,y:0},size:{width:0,height:0}}},scrollTo:e=>this.scrollTo(e),isScrolling:()=>this.state.isScrolling,isSmoothScrolling:()=>this.state.isSmoothScrolling,onScrollChange:this.scrollMetrics$.on,onViewportChange:this.viewportMetrics$.on,onViewportResize:this.viewportResize$.on,onScrollActivity:this.scrollActivity$.on}}setViewportResizeMetrics(e){this.registry.isDestroyed()||(this.dispatch(Ps(e)),this.viewportResize$.emit(this.state.viewportMetrics))}setViewportScrollMetrics(e){this.registry.isDestroyed()||(e.scrollTop!==this.state.viewportMetrics.scrollTop||e.scrollLeft!==this.state.viewportMetrics.scrollLeft)&&(this.dispatch(Xs(e)),this.bumpScrollActivity(),this.scrollMetrics$.emit({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}))}onScrollRequest(e){return this.scrollReq$.on(e)}registerBoundingRectProvider(e){this.rectProvider=e}bumpScrollActivity(){this.debouncedDispatch(Zs(!1),this.scrollEndDelay),this.debouncedDispatch(ot(!1),this.scrollEndDelay)}scrollTo(e){const{x:i,y:s,center:r,behavior:a="auto"}=e;if(a==="smooth"&&this.dispatch(ot(!0)),r){const o=this.state.viewportMetrics,n=i-o.clientWidth/2,l=s-o.clientHeight/2;this.scrollReq$.emit({x:n,y:l,behavior:a})}else this.scrollReq$.emit({x:i,y:s,behavior:a})}emitScrollActivity(){const e={isSmoothScrolling:this.state.isSmoothScrolling,isScrolling:this.state.isScrolling};this.scrollActivity$.emit(e)}onStoreUpdated(e,i){e!==i&&(this.viewportMetrics$.emit(i.viewportMetrics),(e.isScrolling!==i.isScrolling||e.isSmoothScrolling!==i.isSmoothScrolling)&&this.emitScrollActivity())}async initialize(e){}async destroy(){super.destroy(),this.viewportMetrics$.clear(),this.viewportResize$.clear(),this.scrollMetrics$.clear(),this.scrollReq$.clear(),this.scrollActivity$.clear(),this.rectProvider=null}};zt.id="viewport";let Ke=zt;const Ks={manifest:Vs,create:(t,e)=>new Ke(Tt,t,e),reducer:js,initialState:It},Fs=()=>Te(Ke.id),Ys=()=>je(Ke.id);function Qs(){const{plugin:t}=Fs();let e=ee(null);return yi(()=>{if(!t)return;const i=b(e);if(!i)return;const s=()=>{const n=i.getBoundingClientRect();return{origin:{x:n.left,y:n.top},size:{width:n.width,height:n.height}}};t.registerBoundingRectProvider(s);const r=()=>{t?.setViewportScrollMetrics({scrollTop:i.scrollTop,scrollLeft:i.scrollLeft})};i.addEventListener("scroll",r);const a=new ResizeObserver(()=>{t?.setViewportResizeMetrics({width:i.offsetWidth,height:i.offsetHeight,clientWidth:i.clientWidth,clientHeight:i.clientHeight,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft,scrollWidth:i.scrollWidth,scrollHeight:i.scrollHeight})});a.observe(i);const o=t.onScrollRequest(({x:n,y:l,behavior:c="auto"})=>{requestAnimationFrame(()=>{i.scrollTo({left:n,top:l,behavior:c})})});return()=>{t?.registerBoundingRectProvider(null),i.removeEventListener("scroll",r),a.disconnect(),o()}}),{get containerRef(){return b(e)},set containerRef(i){F(e,i,!0)}}}var Js=V("<div><!></div>");function er(t,e){X(e,!0);let i=Ue(e,["$$slots","$$events","$$legacy","children","class"]),s=ee(0),r=Qs();const a=Ys();G(()=>{a.provides&&F(s,a.provides.getViewportGap(),!0)});var o=Js();Ae(o,l=>({...i,class:e.class,[mt]:l}),[()=>({width:"100%",height:"100%",overflow:"auto",padding:`${b(s)}px`})]);var n=ce(o);Y(n,()=>e.children),K(o),ft(o,l=>r.containerRef=l,()=>r?.containerRef),L(t,o),Z()}var H=(t=>(t.Vertical="vertical",t.Horizontal="horizontal",t))(H||{});class qt{constructor(e){this.pageGap=e.pageGap??20,this.viewportGap=e.viewportGap??20,this.bufferSize=e.bufferSize??2}getVisibleRange(e,i,s){const r=this.getScrollOffset(e),a=this.getClientSize(e),o=r,n=r+a;let l=0;for(;l<i.length&&(i[l].offset+i[l].height)*s<=o;)l++;let c=l;for(;c<i.length&&i[c].offset*s<=n;)c++;return{start:Math.max(0,l-this.bufferSize),end:Math.min(i.length-1,c+this.bufferSize-1)}}handleScroll(e,i,s){const r=this.getVisibleRange(e,i,s),a=i.slice(r.start,r.end+1),o=this.calculatePageVisibility(a,e,s),n=o.map(p=>p.pageNumber),l=i.slice(r.start,r.end+1).flatMap(p=>p.index),c=this.determineCurrentPage(o),u=i[r.start],h=i[r.end],g=u?u.offset*s:0,d=h?(i[i.length-1].offset+i[i.length-1].height)*s-(h.offset+h.height)*s:0;return{currentPage:c,visiblePages:n,pageVisibilityMetrics:o,renderedPageIndexes:l,scrollOffset:{x:e.scrollLeft,y:e.scrollTop},startSpacing:g,endSpacing:d}}calculatePageVisibility(e,i,s){const r=[];return e.forEach(a=>{a.pageLayouts.forEach(o=>{const n=a.x*s,l=a.y*s,c=n+o.x*s,u=l+o.y*s,h=o.rotatedWidth*s,g=o.rotatedHeight*s,d=i.scrollLeft,p=i.scrollTop,R=d+i.clientWidth,_=p+i.clientHeight,m=Math.max(c,d),y=Math.max(u,p),x=Math.min(c+h,R),I=Math.min(u+g,_);if(m<x&&y<I){const C=x-m,z=I-y,T=h*g,k=C*z;r.push({pageNumber:o.pageNumber,viewportX:m-d,viewportY:y-p,visiblePercentage:k/T*100,original:{pageX:(m-c)/s,pageY:(y-u)/s,visibleWidth:C/s,visibleHeight:z/s,scale:1},scaled:{pageX:m-c,pageY:y-u,visibleWidth:C,visibleHeight:z,scale:s}})}})}),r}determineCurrentPage(e){if(e.length===0)return 1;const i=Math.max(...e.map(r=>r.visiblePercentage)),s=e.filter(r=>r.visiblePercentage===i);return s.length===1?s[0].pageNumber:s.sort((r,a)=>r.pageNumber-a.pageNumber)[0].pageNumber}getRectLocationForPage(e,i,s){const r=i.find(n=>n.pageNumbers.includes(e));if(!r)return null;const a=r.pageLayouts.find(n=>n.pageNumber===e);if(!a)return null;let o=0;if(s){const n=s.width;r.width<n&&(o=(n-r.width)/2)}return{origin:{x:r.x+a.x+o,y:r.y+a.y},size:{width:a.width,height:a.height}}}getScrollPositionForPage(e,i,s,r,a){const o=this.getTotalContentSize(i),n=this.getRectLocationForPage(e,i,o);if(!n)return null;const l=$e(n.origin,s);if(a){const c=Ni({width:n.size.width,height:n.size.height},{x:a.x,y:a.y},r,s);return{x:l.x+c.x+this.viewportGap,y:l.y+c.y+this.viewportGap}}return{x:l.x+this.viewportGap,y:l.y+this.viewportGap}}getRectPositionForPage(e,i,s,r,a){const o=this.getTotalContentSize(i),n=this.getRectLocationForPage(e,i,o);if(!n)return null;const l=$e(n.origin,s),c=$i({width:n.size.width,height:n.size.height},a,r,s);return{origin:{x:l.x+c.origin.x,y:l.y+c.origin.y},size:c.size}}}class Ie extends qt{constructor(e){super(e)}createVirtualItems(e){let i=0;return e.map((s,r)=>{let a=0;const o=s.map(u=>{const h={pageNumber:u.index+1,pageIndex:u.index,x:a,y:0,width:u.size.width,height:u.size.height,rotatedWidth:u.rotatedSize.width,rotatedHeight:u.rotatedSize.height};return a+=u.rotatedSize.width+this.pageGap,h}),n=s.reduce((u,h,g)=>u+h.rotatedSize.width+(g<s.length-1?this.pageGap:0),0),l=Math.max(...s.map(u=>u.rotatedSize.height)),c={id:`item-${r}`,x:0,y:i,offset:i,width:n,height:l,pageLayouts:o,pageNumbers:s.map(u=>u.index+1),index:r};return i+=l+this.pageGap,c})}getTotalContentSize(e){if(e.length===0)return{width:0,height:0};const i=Math.max(...e.map(r=>r.width)),s=e[e.length-1].y+e[e.length-1].height;return{width:i,height:s}}getScrollOffset(e){return e.scrollTop}getClientSize(e){return e.clientHeight}}class ze extends qt{constructor(e){super(e)}createVirtualItems(e){let i=0;return e.map((s,r)=>{let a=0;const o=s.map(u=>{const h={pageNumber:u.index+1,pageIndex:u.index,x:a,y:0,width:u.size.width,height:u.size.height,rotatedWidth:u.rotatedSize.width,rotatedHeight:u.rotatedSize.height};return a+=u.rotatedSize.width+this.pageGap,h}),n=s.reduce((u,h,g)=>u+h.rotatedSize.width+(g<s.length-1?this.pageGap:0),0),l=Math.max(...s.map(u=>u.rotatedSize.height)),c={id:`item-${r}`,x:i,y:0,offset:i,width:n,height:l,pageLayouts:o,pageNumbers:s.map(u=>u.index+1),index:r};return i+=n+this.pageGap,c})}getTotalContentSize(e){if(e.length===0)return{width:0,height:0};const i=e[e.length-1].x+e[e.length-1].width,s=Math.max(...e.map(r=>r.height));return{width:i,height:s}}getScrollOffset(e){return e.scrollLeft}getClientSize(e){return e.clientWidth}}const Dt="UPDATE_SCROLL_STATE",tr="SET_DESIRED_SCROLL_POSITION",Nt="UPDATE_TOTAL_PAGES",Ot="SET_PAGE_CHANGE_STATE";function nt(t){return{type:Dt,payload:t}}function ir(t){return{type:Nt,payload:t}}function lt(t){return{type:Ot,payload:t}}const sr=(t,e)=>({startSpacing:t.startSpacing,endSpacing:t.endSpacing,totalWidth:t.totalContentSize.width*e,totalHeight:t.totalContentSize.height*e,pageGap:t.pageGap*e,strategy:t.strategy,items:t.renderedPageIndexes.map(i=>({...t.virtualItems[i],pageLayouts:t.virtualItems[i].pageLayouts.map(s=>({...s,rotatedWidth:s.rotatedWidth*e,rotatedHeight:s.rotatedHeight*e,width:s.width*e,height:s.height*e}))}))}),$t=class extends me{constructor(e,i,s){var r,a,o,n;super(e,i),this.id=e,this.config=s,this.currentScale=1,this.currentRotation=Ge.Degree0,this.currentPage=1,this.layoutReady=!1,this.pageChangeState$=M(),this.layout$=M(),this.scroll$=M(),this.state$=M(),this.scrollerLayout$=M(),this.pageChange$=M(),this.layoutReady$=M(),this.viewport=this.registry.getPlugin("viewport").provides(),this.strategyConfig={pageGap:((r=this.config)==null?void 0:r.pageGap)??10,viewportGap:this.viewport.getViewportGap(),bufferSize:((a=this.config)==null?void 0:a.bufferSize)??2},this.strategy=((o=this.config)==null?void 0:o.strategy)===H.Horizontal?new ze(this.strategyConfig):new Ie(this.strategyConfig),this.initialPage=(n=this.config)==null?void 0:n.initialPage,this.currentScale=this.coreState.core.scale,this.currentRotation=this.coreState.core.rotation,this.viewport.onScrollActivity(l=>{this.state.pageChangeState.isChanging&&!l.isSmoothScrolling&&this.completePageChange()}),this.viewport.onViewportChange(l=>this.commitMetrics(this.computeMetrics(l)),{mode:"throttle",wait:100}),this.coreStore.onAction(pe,(l,c)=>{const u=c.core.pages.length;this.dispatch(ir(u)),this.pageChange$.emit({pageNumber:this.currentPage,totalPages:u}),this.refreshAll(he(c.core),this.viewport.getMetrics())}),this.coreStore.onAction(Se,(l,c)=>this.refreshAll(he(c.core),this.viewport.getMetrics())),this.coreStore.onAction(Re,(l,c)=>this.refreshAll(he(c.core),this.viewport.getMetrics()))}startPageChange(e,i="smooth"){const s={isChanging:!0,targetPage:e,fromPage:this.currentPage,startTime:Date.now()};this.dispatch(lt(s)),i==="instant"&&this.completePageChange()}completePageChange(){if(!this.state.pageChangeState.isChanging)return;const e={isChanging:!1,targetPage:this.state.pageChangeState.targetPage,fromPage:this.state.pageChangeState.fromPage,startTime:this.state.pageChangeState.startTime};this.dispatch(lt(e))}computeLayout(e){const i=this.strategy.createVirtualItems(e),s=this.strategy.getTotalContentSize(i);return{virtualItems:i,totalContentSize:s}}computeMetrics(e,i=this.state.virtualItems){return this.strategy.handleScroll(e,i,this.currentScale)}commit(e,i){this.dispatch(nt(e)),i?.layout&&this.layout$.emit(i.layout),i?.metrics&&(this.scroll$.emit(i.metrics),i.metrics.currentPage!==this.currentPage&&(this.currentPage=i.metrics.currentPage,this.pageChange$.emit({pageNumber:this.currentPage,totalPages:this.state.totalPages}))),this.scrollerLayout$.emit(this.getScrollerLayout())}commitMetrics(e){this.commit(e,{metrics:e})}refreshAll(e,i){const s=this.computeLayout(e),r=this.computeMetrics(i,s.virtualItems);this.commit({...s,...r},{layout:s,metrics:r})}getVirtualItemsFromState(){return this.state.virtualItems||[]}onScrollerData(e){return this.scrollerLayout$.on(e)}getScrollerLayout(){const e=this.coreState.core.scale;return sr(this.state,e)}pushScrollLayout(){this.scrollerLayout$.emit(this.getScrollerLayout())}onStoreUpdated(e,i){this.pushScrollLayout(),e.pageChangeState!==i.pageChangeState&&this.pageChangeState$.emit(i.pageChangeState)}onCoreStoreUpdated(e,i){e.core.scale!==i.core.scale&&(this.currentScale=i.core.scale,this.commitMetrics(this.computeMetrics(this.viewport.getMetrics()))),e.core.rotation!==i.core.rotation&&(this.currentRotation=i.core.rotation)}setScrollStrategy(e){if(e===H.Horizontal&&this.strategy instanceof ze||e===H.Vertical&&this.strategy instanceof Ie)return;this.strategy=e===H.Horizontal?new ze(this.strategyConfig):new Ie(this.strategyConfig),this.dispatch(nt({strategy:e}));const i=he(this.coreState.core);this.refreshAll(i,this.viewport.getMetrics())}setLayoutReady(){this.layoutReady||(this.layoutReady=!0,this.layoutReady$.emit(!0),this.initialPage&&this.scrollToPage({pageNumber:this.initialPage,behavior:"instant"}))}buildCapability(){return{onStateChange:this.state$.on,onLayoutChange:this.layout$.on,onScroll:this.scroll$.on,onPageChange:this.pageChange$.on,onLayoutReady:this.layoutReady$.on,onPageChangeState:this.pageChangeState$.on,getCurrentPage:()=>this.currentPage,getTotalPages:()=>this.state.totalPages,getPageChangeState:()=>this.state.pageChangeState,scrollToPage:this.scrollToPage.bind(this),scrollToNextPage:this.scrollToNextPage.bind(this),scrollToPreviousPage:this.scrollToPreviousPage.bind(this),getMetrics:this.getMetrics.bind(this),getLayout:this.getLayout.bind(this),getRectPositionForPage:this.getRectPositionForPage.bind(this),getPageGap:()=>this.state.pageGap,setScrollStrategy:e=>this.setScrollStrategy(e)}}scrollToPage(e){const{pageNumber:i,behavior:s="smooth",pageCoordinates:r,center:a=!1}=e;this.startPageChange(i,s);const o=this.getVirtualItemsFromState(),n=this.strategy.getScrollPositionForPage(i,o,this.currentScale,this.currentRotation,r);n?this.viewport.scrollTo({...n,behavior:s,center:a}):this.completePageChange()}scrollToNextPage(e="smooth"){const i=this.getVirtualItemsFromState(),s=i.findIndex(r=>r.pageNumbers.includes(this.currentPage));if(s>=0&&s<i.length-1){const r=i[s+1],a=r.pageNumbers[0];this.startPageChange(a,e);const o=this.strategy.getScrollPositionForPage(r.pageNumbers[0],i,this.currentScale,this.currentRotation);o?this.viewport.scrollTo({...o,behavior:e}):this.completePageChange()}}scrollToPreviousPage(e="smooth"){const i=this.getVirtualItemsFromState(),s=i.findIndex(r=>r.pageNumbers.includes(this.currentPage));if(s>0){const r=i[s-1],a=r.pageNumbers[0];this.startPageChange(a,e);const o=this.strategy.getScrollPositionForPage(r.pageNumbers[0],i,this.currentScale,this.currentRotation);o?this.viewport.scrollTo({...o,behavior:e}):this.completePageChange()}}getMetrics(e){const i=e||this.viewport.getMetrics(),s=this.getVirtualItemsFromState();return this.strategy.handleScroll(i,s,this.currentScale)}getLayout(){return{virtualItems:this.state.virtualItems,totalContentSize:this.state.totalContentSize}}getRectPositionForPage(e,i,s,r){return this.strategy.getRectPositionForPage(e+1,this.state.virtualItems,s??this.currentScale,r??this.currentRotation,i)}async initialize(){}async destroy(){this.layout$.clear(),this.scroll$.clear(),this.pageChange$.clear(),this.state$.clear(),this.scrollerLayout$.clear(),this.layoutReady$.clear(),this.pageChangeState$.clear(),super.destroy()}};$t.id="scroll";let Ht=$t;const Mt="scroll",rr={id:Mt,name:"Scroll Plugin",version:"1.0.0",provides:["scroll"],requires:["viewport"],optional:[],defaultConfig:{enabled:!0,pageGap:10}},ar={currentPage:1,visiblePages:[],pageVisibilityMetrics:[],renderedPageIndexes:[],scrollOffset:{x:0,y:0},startSpacing:0,endSpacing:0},or={isChanging:!1,targetPage:1,fromPage:1,startTime:0},nr=(t,e)=>({virtualItems:[],totalPages:t.pages.length,totalContentSize:{width:0,height:0},desiredScrollPosition:{x:0,y:0},strategy:e.strategy??H.Vertical,pageGap:e.pageGap??10,scale:t.scale,pageChangeState:or,...ar}),lr=(t,e)=>{switch(e.type){case Nt:return{...t,totalPages:e.payload};case be:return{...t,scale:e.payload};case Dt:return{...t,...e.payload};case tr:return{...t,desiredScrollPosition:e.payload};case Ot:return{...t,pageChangeState:e.payload};default:return t}},cr={manifest:rr,create:(t,e)=>new Ht(Mt,t,e),reducer:lr,initialState:(t,e)=>nr(t,e)},ur=()=>Te(Ht.id);var hr=V("<div><!></div>"),gr=V("<div></div>"),dr=V("<div><div></div> <div></div> <div></div> <!></div>");function pr(t,e){X(e,!0);const i=ur(),s=As();let r=ne(()=>{var c;return((c=i.plugin)==null?void 0:c.getScrollerLayout())??null}),a=Ue(e,["$$slots","$$events","$$legacy","RenderPageSnippet","overlayElements"]);G(()=>{if(i.plugin)return i.plugin.onScrollerData(c=>F(r,c))}),G(()=>{i.plugin&&i.plugin.setLayoutReady()});var o=A(),n=O(o);{var l=c=>{var u=dr();Ae(u,x=>({...a,[mt]:x}),[()=>({width:`${b(r).totalWidth}px`,height:`${b(r).totalHeight}px`,position:"relative","box-sizing":"border-box",margin:"0 auto",display:b(r).strategy===H.Horizontal?"flex":null,"flex-direction":b(r).strategy===H.Horizontal?"row":null})]);var h=ce(u);let g;var d=oe(h,2);let p;ve(d,21,()=>b(r).items,x=>x.pageNumbers[0],(x,I)=>{var C=gr();let z;ve(C,21,()=>b(I).pageLayouts,T=>T.pageNumber,(T,k)=>{var E=hr();let j;var ie=ce(E);{let N=ne(()=>({...b(k),rotation:s.coreState.rotation,scale:s.coreState.scale,document:s.coreState.document}));Y(ie,()=>e.RenderPageSnippet??le,()=>b(N))}K(E),ge(N=>j=ae(E,"",j,N),[()=>({width:`${b(k).rotatedWidth}px`,height:`${b(k).rotatedHeight}px`})]),L(T,E)}),K(C),ge(T=>z=ae(C,"",z,T),[()=>({display:"flex","justify-content":"center",gap:`${b(r).pageGap}px`})]),L(x,C)}),K(d);var R=oe(d,2);let _;var m=oe(R,2);{var y=x=>{var I=A(),C=O(I);ve(C,17,()=>e.overlayElements,ki,(z,T)=>{var k=A(),E=O(k);Y(E,()=>b(T)??le),L(z,k)}),L(x,I)};te(m,x=>{e.overlayElements&&e.overlayElements.length>0&&x(y)})}K(u),ge((x,I,C)=>{g=ae(h,"",g,x),p=ae(d,"",p,I),_=ae(R,"",_,C)},[()=>({width:b(r).strategy===H.Horizontal?`${b(r).startSpacing}px`:"100%",height:b(r).strategy===H.Horizontal?"100%":`${b(r).startSpacing}px`,"flex-shrink":"0"}),()=>({gap:`${b(r).pageGap}px`,display:"flex","align-items":"center",position:"relative","box-sizing":"border-box","flex-direction":b(r).strategy===H.Horizontal?"row":"column","min-width":b(r).strategy===H.Horizontal?"100%":"fit-content"}),()=>({width:b(r).strategy===H.Horizontal?`${b(r).endSpacing}px`:"100%",height:b(r).strategy===H.Horizontal?"100%":`${b(r).endSpacing}px`,"flex-shrink":"0"})]),L(c,u)};te(n,c=>{b(r)&&s.coreState&&c(l)})}L(t,o),Z()}class mr{async load(e){const{pdfFile:i,options:s,engine:r}=e,a=r.openDocumentUrl(i,s);return new Promise((o,n)=>{a.wait(l=>o(l),l=>{l.type==="abort"?n(new Error(`PDF loading aborted: ${l.reason}`)):n(new Error(`PDF loading failed: ${l.reason}`))})})}}class fr{async load(e){const{pdfFile:i,options:s,engine:r}=e,a=r.openDocumentBuffer(i,s);return new Promise((o,n)=>{a.wait(l=>o(l),l=>{l.type==="abort"?n(new Error(`PDF loading aborted: ${l.reason}`)):n(new Error(`PDF loading failed: ${l.reason}`))})})}}class vr{constructor(){this.strategies=new Map,this.strategyResolvers=[];const e=new fr;this.registerStrategy("url",new mr),this.registerStrategy("buffer",e),this.addStrategyResolver(i=>yr(i)?this.strategies.get("url"):this.strategies.get("buffer"))}registerStrategy(e,i){this.strategies.set(e,i)}getStrategy(e){return this.strategies.get(e)}addStrategyResolver(e){this.strategyResolvers.push(e)}async loadDocument(e){try{const i=this.resolveStrategy(e);if(!i)throw new Error("No suitable strategy found for the given options");return await i.load(e)}catch(i){throw console.error("Error loading document:",i),i}}resolveStrategy(e){for(const i of this.strategyResolvers){const s=i(e);if(s)return s}}}function yr(t){return t.type==="url"}const At=class extends me{constructor(e,i){super(e,i),this.id=e,this.loaderHandlers$=M(),this.documentLoadedHandlers$=M(),this.openFileRequest$=Ce(),this.documentLoader=new vr}buildCapability(){return{onLoaderEvent:this.loaderHandlers$.on,onDocumentLoaded:this.documentLoadedHandlers$.on,onOpenFileRequest:this.openFileRequest$.on,openFileDialog:()=>this.openFileRequest$.emit("open"),loadDocument:e=>this.loadDocument(e),registerStrategy:(e,i)=>this.documentLoader.registerStrategy(e,i),getDocument:()=>this.loadedDocument,addStrategyResolver:e=>this.documentLoader.addStrategyResolver(e)}}async initialize(e){e.defaultStrategies&&Object.entries(e.defaultStrategies).forEach(([i,s])=>{this.documentLoader.registerStrategy(i,s)}),e.loadingOptions&&(this.loadingOptions=e.loadingOptions)}async postInitialize(){this.loadingOptions&&await this.loadDocument(this.loadingOptions)}async loadDocument(e){try{this.loadedDocument&&this.engine.closeDocument(this.loadedDocument),this.loaderHandlers$.emit({type:"start",documentId:e.pdfFile.id}),this.dispatchCoreAction(Cs());const i=await this.documentLoader.loadDocument({...e,engine:this.engine});return this.dispatchCoreAction(Ts(i)),this.loadedDocument=i,this.loaderHandlers$.emit({type:"complete",documentId:e.pdfFile.id}),this.documentLoadedHandlers$.emit(i),i}catch(i){const s={type:"error",documentId:e.pdfFile.id,error:i instanceof Error?i:new Error(String(i))};throw this.loaderHandlers$.emit(s),i}}async destroy(){this.loaderHandlers$.clear(),this.documentLoadedHandlers$.clear(),this.openFileRequest$.clear(),super.destroy()}};At.id="loader";let Ut=At;const Gt="loader",wr={id:Gt,name:"Loader Plugin",version:"1.0.0",provides:["loader"],requires:[],optional:[],metadata:{name:"Loader Plugin",description:"A plugin for loading PDF documents",version:"1.0.0",author:"EmbedPDF",license:"MIT"},defaultConfig:{enabled:!0}},br={manifest:wr,create:t=>new Ut(Gt,t),reducer:()=>{},initialState:{}},Sr=()=>je(Ut.id);async function Rr(t,e){var i;const r=(i=t.target.files)==null?void 0:i[0],a=e.provides;if(r&&a){const o=await r.arrayBuffer();await a.loadDocument({type:"buffer",pdfFile:{id:Math.random().toString(36).substring(2,15),name:r.name,content:o}})}}var Cr=V('<input type="file" accept="application/pdf" style="display: none"/>');function Tr(t,e){X(e,!0);const i=Sr();let s=null;G(()=>{if(!i.provides)return;const a=i.provides.onOpenFileRequest(o=>{o==="open"&&s&&s.click()});return()=>{a()}});var r=Cr();r.__change=[Rr,i],ft(r,a=>s=a,()=>s),L(t,r),Z()}Ci(["change"]);const xr=Hs(br).addUtility(Tr).build(),Wt=class extends me{constructor(e,i){super(e,i),this.refreshPages$=Ce(),this.coreStore.onAction(Ss,s=>{this.refreshPages$.emit(s.payload)})}async initialize(e){}buildCapability(){return{renderPage:this.renderPage.bind(this),renderPageRect:this.renderPageRect.bind(this)}}onRefreshPages(e){return this.refreshPages$.on(e)}renderPage({pageIndex:e,options:i}){const s=this.coreState.core;if(!s.document)throw new Error("document does not open");const r=s.document.pages.find(a=>a.index===e);if(!r)throw new Error("page does not exist");return this.engine.renderPage(s.document,r,i)}renderPageRect({pageIndex:e,rect:i,options:s}){const r=this.coreState.core;if(!r.document)throw new Error("document does not open");const a=r.document.pages.find(o=>o.index===e);if(!a)throw new Error("page does not exist");return this.engine.renderPageRect(r.document,a,i,s)}};Wt.id="render";let Fe=Wt;const Vt="render",kr={id:Vt,name:"Render Plugin",version:"1.0.0",provides:["render"],requires:[],optional:[],defaultConfig:{enabled:!0}},Lr={manifest:kr,create:t=>new Fe(Vt,t),reducer:()=>{},initialState:{}},Er=()=>Te(Fe.id),_r=()=>je(Fe.id);var Ir=V("<img/>");function zr(t,e){X(e,!0);let i=Ue(e,["$$slots","$$events","$$legacy","pageIndex","scale","dpr","class"]);const s=_r(),r=Er(),a=ne(()=>e.scale??1);let o=ee(null),n=null,l=ee(0);G(()=>{if(r.plugin)return r.plugin.onRefreshPages(d=>{d.includes(e.pageIndex)&&wi(l)})}),G(()=>{b(l);const d=s.provides;if(!d)return;const p=d.renderPage({pageIndex:e.pageIndex,options:{scaleFactor:b(a),dpr:e.dpr||window.devicePixelRatio}});return p.wait(R=>{const _=URL.createObjectURL(R);n&&URL.revokeObjectURL(n),F(o,_,!0),n=_},wt),()=>{n?(URL.revokeObjectURL(n),n=null):p.abort({code:Ve.Cancelled,message:"canceled render task"})}});function c(){n&&(URL.revokeObjectURL(n),n=null)}var u=A(),h=O(u);{var g=d=>{var p=Ir();Ae(p,()=>({src:b(o),onload:c,...i,style:"width: 100%; height: 100%;",class:e.class,alt:""})),Ti(p),L(d,p)};te(h,d=>{b(o)&&d(g)})}L(t,u),Z()}var U=(t=>(t.Automatic="automatic",t.FitPage="fit-page",t.FitWidth="fit-width",t))(U||{}),Q=(t=>(t[t.Center=0]="Center",t[t.Top=1]="Top",t))(Q||{});const Bt="zoom",qr={id:Bt,name:"Zoom Plugin",version:"1.0.0",provides:["zoom"],requires:["viewport","scroll"],optional:["interaction-manager"],defaultConfig:{enabled:!0,defaultZoomLevel:U.Automatic,minZoom:.2,maxZoom:60,zoomStep:.1,zoomRanges:[{min:.2,max:.5,step:.05},{min:.5,max:1,step:.1},{min:1,max:2,step:.2},{min:2,max:4,step:.4},{min:4,max:10,step:.8},{min:10,max:20,step:1.6},{min:20,max:40,step:3.2},{min:40,max:60,step:6.4}],presets:[{name:"Fit Page",value:U.FitPage},{name:"Fit Width",value:U.FitWidth},{name:"Automatic",value:U.Automatic},{name:"25%",value:.25},{name:"50%",value:.5},{name:"100%",value:1},{name:"125%",value:1.25},{name:"150%",value:1.5},{name:"200%",value:2},{name:"400%",value:4},{name:"800%",value:8},{name:"1600%",value:16}]}},Pt="SET_ZOOM_LEVEL",Xt="SET_INITIAL_ZOOM_LEVEL";function Dr(t,e){return{type:Pt,payload:{zoomLevel:t,currentZoomLevel:e}}}function Nr(t){return{type:Xt,payload:{zoomLevel:t}}}const Zt={zoomLevel:U.Automatic,currentZoomLevel:1},Or=(t=Zt,e)=>{switch(e.type){case Pt:return{...t,zoomLevel:e.payload.zoomLevel,currentZoomLevel:e.payload.currentZoomLevel};case Xt:return{...t,zoomLevel:e.payload.zoomLevel};default:return t}};function $r(t){const{pageSize:e,scale:i,minDragPx:s=5,onPreview:r,onCommit:a,onSmallDrag:o}=t;let n=null,l=null;return{onPointerDown:(c,u)=>{var h;n=c,l={origin:{x:c.x,y:c.y},size:{width:0,height:0}},r?.(l),(h=u.setPointerCapture)==null||h.call(u)},onPointerMove:c=>{if(!n)return;const u=we(c.x,0,e.width),h=we(c.y,0,e.height);l={origin:{x:Math.min(n.x,u),y:Math.min(n.y,h)},size:{width:Math.abs(u-n.x),height:Math.abs(h-n.y)}},r?.(l)},onPointerUp:(c,u)=>{var h;l&&(Math.max(l.size.width,l.size.height)*i>s?a?.(l):o?.()),n=null,l=null,r?.(null),(h=u.releasePointerCapture)==null||h.call(u)},onPointerCancel:(c,u)=>{var h;n=null,l=null,r?.(null),(h=u.releasePointerCapture)==null||h.call(u)}}}const jt=class extends me{constructor(e,i,s){var r;super(e,i),this.zoom$=Ce(),this.state$=M(),this.viewportPlugin=i.getPlugin("viewport"),this.viewport=this.viewportPlugin.provides(),this.scroll=i.getPlugin("scroll").provides();const a=i.getPlugin("interaction-manager");this.interactionManager=a?.provides()??null,this.minZoom=s.minZoom??.25,this.maxZoom=s.maxZoom??10,this.zoomStep=s.zoomStep??.1,this.presets=s.presets??[],this.zoomRanges=this.normalizeRanges(s.zoomRanges??[]),this.dispatch(Nr(s.defaultZoomLevel)),this.viewport.onViewportResize(()=>this.recalcAuto(Q.Top),{mode:"debounce",wait:150}),this.coreStore.onAction(Se,()=>this.recalcAuto(Q.Top)),this.coreStore.onAction(Re,()=>this.recalcAuto(Q.Top)),this.coreStore.onAction(pe,()=>this.recalcAuto(Q.Top)),(r=this.interactionManager)==null||r.registerMode({id:"marqueeZoom",scope:"page",exclusive:!0,cursor:"zoom-in"}),this.resetReady()}buildCapability(){return{onZoomChange:this.zoom$.on,onStateChange:this.state$.on,zoomIn:()=>this.zoomIn(),zoomOut:()=>this.zoomOut(),zoomToArea:(e,i)=>this.zoomToArea(e,i),requestZoom:(e,i)=>this.handleRequest({level:e,center:i}),requestZoomBy:(e,i)=>{const s=this.state.currentZoomLevel,r=this.toZoom(s+e);return this.handleRequest({level:r,center:i})},enableMarqueeZoom:()=>{var e;(e=this.interactionManager)==null||e.activate("marqueeZoom")},disableMarqueeZoom:()=>{var e;(e=this.interactionManager)==null||e.activateDefaultMode()},toggleMarqueeZoom:()=>{var e,i,s;((e=this.interactionManager)==null?void 0:e.getActiveMode())==="marqueeZoom"?(i=this.interactionManager)==null||i.activateDefaultMode():(s=this.interactionManager)==null||s.activate("marqueeZoom")},isMarqueeZoomActive:()=>{var e;return((e=this.interactionManager)==null?void 0:e.getActiveMode())==="marqueeZoom"},registerMarqueeOnPage:e=>this.registerMarqueeOnPage(e),getState:()=>this.state,getPresets:()=>this.presets}}zoomOut(){const e=this.state.currentZoomLevel;return this.handleRequest({level:e,delta:-this.stepFor(e)})}zoomIn(){const e=this.state.currentZoomLevel;return this.handleRequest({level:e,delta:this.stepFor(e)})}zoomToArea(e,i){this.handleZoomToArea(e,i)}async initialize(){this.markReady()}async destroy(){this.zoom$.clear()}normalizeRanges(e){return[...e].filter(i=>i.step>0&&i.max>i.min).sort((i,s)=>i.min-s.min)}stepFor(e){const i=this.zoomRanges.find(s=>e>=s.min&&e<s.max);return i?i.step:this.zoomStep}toZoom(e){return parseFloat(we(e,this.minZoom,this.maxZoom).toFixed(2))}handleRequest({level:e,delta:i=0,center:s,focus:r=Q.Center,align:a="keep"}){const o=this.viewport.getMetrics(),n=this.state.currentZoomLevel;if(o.clientWidth===0||o.clientHeight===0)return;const l=typeof e=="number"?e:this.computeZoomForMode(e,o);if(l===!1)return;const c=we(l+i,this.minZoom,this.maxZoom),u=Math.floor(c*100)/100,h=s??{vx:o.clientWidth/2,vy:r===Q.Top?0:o.clientHeight/2},{desiredScrollLeft:g,desiredScrollTop:d}=this.computeScrollForZoomChange(o,n,u,h,a);!isNaN(g)&&!isNaN(d)&&this.viewportPlugin.setViewportScrollMetrics({scrollLeft:g,scrollTop:d}),this.dispatch(Dr(typeof e=="number"?u:e,u)),this.dispatchCoreAction(xs(u)),this.markReady(),this.viewport.scrollTo({x:g,y:d,behavior:"instant"});const p={oldZoom:n,newZoom:u,level:e,center:h,desiredScrollLeft:g,desiredScrollTop:d,viewport:o};this.zoom$.emit(p)}computeZoomForMode(e,i){const s=he(this.coreState.core);if(!s.length)return!1;const r=this.scroll.getPageGap(),a=this.viewport.getViewportGap();if(i.clientWidth===0||i.clientHeight===0)return!1;const o=i.clientWidth-2*a,n=i.clientHeight-2*a;if(o<=0||n<=0)return!1;let l=0,c=0;switch(s.forEach(u=>{const h=u.reduce((d,p,R)=>d+p.rotatedSize.width+(R?r:0),0),g=Math.max(...u.map(d=>d.rotatedSize.height));l=Math.max(l,h),c=Math.max(c,g)}),e){case U.FitWidth:return o/l;case U.FitPage:return Math.min(o/l,n/c);case U.Automatic:return Math.min(o/l,1);default:return 1}}computeScrollForZoomChange(e,i,s,r,a="keep"){const o=this.scroll.getLayout(),n=this.viewport.getViewportGap(),l=o.totalContentSize.width,c=o.totalContentSize.height,u=e.clientWidth-2*n,h=e.clientHeight-2*n,g=(T,k,E)=>k*E<T?(T-k*E)/2:0,d=g(u,l,i),p=g(h,c,i),R=g(u,l,s),_=g(h,c,s),m=(e.scrollLeft+r.vx-n-d)/i,y=(e.scrollTop+r.vy-n-p)/i,x=m*s+n+R,I=y*s+n+_,C=a==="center"?x-e.clientWidth/2:x-r.vx,z=a==="center"?I-e.clientHeight/2:I-r.vy;return{desiredScrollLeft:Math.max(0,C),desiredScrollTop:Math.max(0,z)}}handleZoomToArea(e,i){const s=this.coreState.core.rotation,r=this.viewport.getMetrics(),a=this.viewport.getViewportGap(),o=this.state.currentZoomLevel,n=r.clientWidth-2*a,l=r.clientHeight-2*a,c=this.scroll.getLayout(),u=c.virtualItems.find(T=>T.pageLayouts.some(k=>k.pageIndex===e));if(!u)return;const h=u.pageLayouts.find(T=>T.pageIndex===e),g=vt({width:h.width,height:h.height},i,s),d=this.toZoom(Math.min(n/g.size.width,l/g.size.height)),p=u.x+h.x,R=u.y+h.y,_=p+g.origin.x+g.size.width/2,m=R+g.origin.y+g.size.height/2,y=(T,k,E)=>k*E<T?(T-k*E)/2:0,x=y(n,c.totalContentSize.width,o),I=y(l,c.totalContentSize.height,o),C=a+x+_*o-r.scrollLeft,z=a+I+m*o-r.scrollTop;this.handleRequest({level:d,center:{vx:C,vy:z},align:"center"})}recalcAuto(e){const i=this.state;(i.zoomLevel===U.Automatic||i.zoomLevel===U.FitPage||i.zoomLevel===U.FitWidth)&&this.handleRequest({level:i.zoomLevel,focus:e})}onStoreUpdated(e,i){this.state$.emit(i)}registerMarqueeOnPage(e){if(!this.interactionManager)return this.logger.warn("ZoomPlugin","MissingDependency","Interaction manager plugin not loaded, marquee zoom disabled"),()=>{};const i=this.coreState.core.document;if(!i)return this.logger.warn("ZoomPlugin","DocumentNotFound","Document not found"),()=>{};const s=i.pages[e.pageIndex];if(!s)return this.logger.warn("ZoomPlugin","PageNotFound",`Page ${e.pageIndex} not found`),()=>{};const r=$r({pageSize:s.size,scale:e.scale,onPreview:e.callback.onPreview,onCommit:o=>{var n,l;this.zoomToArea(e.pageIndex,o),(l=(n=e.callback).onCommit)==null||l.call(n,o)},onSmallDrag:()=>{var o,n;this.zoomIn(),(n=(o=e.callback).onSmallDrag)==null||n.call(o)}});return this.interactionManager.registerHandlers({modeId:"marqueeZoom",handlers:r,pageIndex:e.pageIndex})}};jt.id="zoom";let Hr=jt;const Mr={manifest:qr,create:(t,e)=>new Hr(Bt,t,e),reducer:Or,initialState:Zt},Ar=(t,e=le)=>{var i=Ur();let s;var r=ce(i);zr(r,{get pageIndex(){return e().pageIndex}}),K(i),ge(()=>s=ae(i,"",s,{width:`${e().width??""}px`,height:`${e().height??""}px`,position:"relative"})),L(t,i)};var Ur=V("<div><!></div>"),Gr=V('<div class="loading-pane svelte-jb02kb">Loading PDF Engine...</div>'),Wr=V('<div class="pdf-container svelte-jb02kb" style="border: 1px solid black;"><!></div>');function Vr(t,e){X(e,!1);const i=vs(),s=[ue(xr,{loadingOptions:{type:"url",pdfFile:{id:"HMS-pdf",url:`${window.location.origin}${xi}/test.pdf`}}}),ue(Ks),ue(cr),ue(Lr),ue(Mr,{defaultZoomLevel:U.FitPage})];ct();var r=Wr(),a=ce(r);{var o=l=>{var c=Gr();L(l,c)},n=l=>{Ws(l,{get engine(){return i.engine},get plugins(){return s},children:(c,u)=>{er(c,{class:"viewport-class",children:(h,g)=>{pr(h,{get RenderPageSnippet(){return Ar}})},$$slots:{default:!0}})},$$slots:{default:!0}})};te(a,l=>{i.isLoading||!i.engine?l(o):l(n,!1)})}K(r),L(t,r),Z()}var Br=V('<div class="flex h-full flex-col"><h1 class="pl-2 text-xl font-bold">1. Les HMS introduksjonen</h1> <!> <a class="mt-1 mb-3 inline-flex items-center justify-center self-center rounded-lg bg-blue-600 px-4 py-2 font-medium text-white hover:bg-blue-700">Jeg bekrefter å ha lest og forstått informasjonen over</a></div>');function Sa(t,e){X(e,!1),ct();var i=Br(),s=oe(ce(i),2);Vr(s,{});var r=oe(s,2);K(i),ge(a=>Si(r,"href",a),[()=>bi("/register")]),L(t,i),Z()}export{is as A,Jr as B,$i as C,ia as D,Yi as E,es as F,ua as G,us as M,We as N,oa as P,Ge as R,P as T,ma as W,Sa as _,Ve as a,da as b,ts as c,hs as d,sa as e,ss as f,ns as g,os as h,wt as i,rs as j,Ji as k,Qi as l,na as m,ca as n,ga as o,ha as p,ea as q,ta as r,st as s,D as t,pa as u,ls as v,la as w,ra as x,aa as y,as as z};
